"use strict";JQX.Utilities.Assign("Grid.Edit",function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,[{key:"_renderCommandBar",value:function(){var e=this,t=e.editing.commandBar.dataSource,i=function(i){for(var n in t)!function(n){var d=t[n],o=document.createElement("div");o.classList.add("jqx-grid-command-item"),o.label=e.localize(n),d.icon&&(o.innerHTML='<span class="jqx-grid-icon '+d.icon+'"></span><span class="jqx-grid-label">'+o.label+"</span>"),d.visible||o.classList.add("jqx-hidden"),o.command=d.command,o.onclick=function(){var t=o.command;e._applyCommand(t,[])},i.appendChild(o)}(n)};e.editing.enabled&&e.editing.commandBar.visible&&(e.$.headerCommandBar.innerHTML="",e.$.footerCommandBar.innerHTML="","far"!==e.editing.commandBar.position&&i(e.$.headerCommandBar),"near"!==e.editing.commandBar.position&&i(e.$.footerCommandBar))}},{key:"commandKeyEditCommand",value:function(){this.beginCellEdit()}},{key:"commandKeyCancelCommand",value:function(){this.cancelEdit()}},{key:"commandKeyUpdateCommand",value:function(){this.endEdit()}},{key:"commandColumnMenuCommand",value:function(){var e=this;e._openColumnChooserMenu(e._commandColumn)}},{key:"commandColumnEditCommand",value:function(e){this.beginEdit(e.id)}},{key:"commandColumnUpdateCommand",value:function(){this.endEdit()}},{key:"commandColumnRowMenuCommand",value:function(){}},{key:"commandColumnCancelCommand",value:function(e){var t=this;if(t.editing.batch){var i=t._rowsDeleted?t._rowsDeleted.indexOf(e):-1;i>=0&&t._rowsDeleted.splice(i,1);for(var n=0;n<t.columns.length;n++){var d=t.columns[n].dataField;t._cellsUpdatedValues&&t._cellsUpdatedValues[e.id+"_"+d]&&(delete t._cellsUpdatedValues[e.id+"_"+d],t._cellsUpdatedValues.length--)}t._recycle(!1)}t.cancelEdit()}},{key:"commandColumnDeleteCommand",value:function(e){this.deleteRow(e.id)}},{key:"deleteRow",value:function(e,t){var i=this,n=i.rowById[e];if(!n)return!1;var d=function(e){if(!0===i.editing.batch||i.editing.batch&&i.editing.batch.indexOf("delete")>=0)i._batchDeleteRow(e);else{var n=i.rows.indexOf(e);i.rows.splice(n,1)}t&&t(e)};return i.editing.deleteDialog.enabled?i._openDeleteRowDialog(n,d):d(n),!0}},{key:"_renderAddNewRow",value:function(){var e=this;e._frozenNearDefaultRows=[],e._frozenFarDefaultRows=[];var t=new JQX.Grid.Row({data:{},index:-1,grid:e,freeze:"near",visible:"far"!==e.editing.addNewRow.position,autoGenerated:!0,addNewRow:!0}),i=new JQX.Grid.Row({data:{},index:-2,grid:e,freeze:"far",visible:"near"!==e.editing.addNewRow.position,autoGenerated:!0,addNewRow:!0});if(e._newNearRow){var n=e._frozenNearRows.indexOf(e._newNearRow);n>=0&&e._frozenNearRows.splice(n,1)}if(e._newFarRow){var d=e._frozenFarRows.indexOf(e._newFarRow);d>=0&&e._frozenFarRows.splice(d,1)}e.editing.addNewRow.visible&&(e._frozenNearDefaultRows.push(t),e._frozenFarDefaultRows.push(i),e._frozenNearRows.push(t),e._frozenFarRows.push(i)),e._scrollView.vScrollBar.$.farButton.addEventListener("click",function(){e.editing.addNewRow.autoCreate&&e._scrollView.vScrollBar.value===e._scrollView.vScrollBar.max&&(e.addUnboundRow(1),e._scrollView.vScrollBar.value=e._scrollView.vScrollBar.max)}),e._newNearRow=t,e._newFarRow=i}},{key:"addUnboundRow",value:function(e,t){var i=this;void 0===e&&(e=1),void 0===t&&(t="far"),i._nearRowsAdded||(i._nearRowsAdded=[],i._farRowsAdded=[]),i._unboundRows||(i._unboundRows=[]),i.beginUpdate();for(var n=0;n<e;n++){var d=JQX.Utilities.Core.createGUID().replace(/-/gi,""),o=new JQX.Grid.Row({index:-1,unbound:!0,id:d,grid:i});i.rowById[o.id]=o,"far"===t?i._farRowsAdded.push(o):i._nearRowsAdded.push(o),i._unboundRows.push(o)}i.endUpdate()}},{key:"_insertNewRowAfter",value:function(e){return this._insertNewRowBefore(e,!0)}},{key:"_insertNewRowBefore",value:function(e,t){var i=this,n=new JQX.Grid.Row({index:t?0:-1,id:JQX.Utilities.Core.createGUID(),grid:i}),d=function(t,n){!0===i.editing.batch||i.editing.batch&&i.editing.batch.indexOf("add")>=0?i._batchAddRow(t,n?i.rows.length:0):(t.index=i.rows.length,i._add(t,n?i.rows.length:0)),i.scrollTop=n?i.scrollHeight:0,i.editing.addDialog.enabled||setTimeout(function(){i.editing.enabled&&i._beginEdit(t)},100),e&&e(t)}.bind(this);return i.editing.addDialog.enabled?i._openAddRowDialog(n,d):d(n,t),!0}},{key:"commandBarBatchSaveCommand",value:function(){this._saveBatchEdit()}},{key:"commandBarAddRowCommand",value:function(){this._insertNewRowAfter()}},{key:"commandBarAddTopRowCommand",value:function(){this._insertNewRowBefore()}},{key:"commandBarDeleteRowCommand",value:function(){var e=this,t=1,i=e.rows[e.rows.length-t];for(e._rowsDeleted||(e._rowsDeleted=[]);e._rowsDeleted.indexOf(e.rows[e.rows.length-t])>=0;)t++;(i=e.rows[e.rows.length-t])&&e.commandColumnDeleteCommand(i)}},{key:"commandBarBatchRevertCommand",value:function(){this.revertBatchEdit()}},{key:"beginEdit",value:function(e,t){var i=this,n=i.rowById[e];n&&i._beginEdit(n,t)}},{key:"_beginEdit",value:function(e,t){var i=this;t||(t=i.columns[0].dataField);var n=i.columnByDataField[t];if(!e||!n||n&&n.autoGenerated)return!1;var d=e.getCell(t);if(!d)return!1;"cell"===i.editing.mode?i._beginCellEdit(d):"row"===i.editing.mode&&i._beginRowEdit(e,d)}},{key:"endEdit",value:function(){var e=this,t=!1,i=null;return e.editing.dialog.enabled&&e.editing.dialog.visible&&e._dialogEdit&&e._dialogEdit.close(),e.editing.editRow?(i=e.editing.editRow.id,t=e._endRowEdit()):e.editing.editCell&&(i=e.editing.editCell.row.id,t=e._endCellEdit()),e._saveUnboundRows(i),t}},{key:"_saveUnboundRows",value:function(e){var t=this;if(t._unboundRows&&t._unboundRows.length>0&&t.editing.addNewRow.autoSave){var i=t.rowById[e];if(!i.unbound)return;var n=t._unboundRows.indexOf(i);if(n<0)return;var d=n+1;t.beginUpdate();for(var o=0;o<d;o++){var a=t._unboundRows[o];if(a){delete t.rowById[a.id],a.unbound=!1;var l=!1;t._selection.focusedCell&&t._selection.focusedCell.row.id===a.id&&(l=!0),t._nearRowsAdded&&t._nearRowsAdded.indexOf(a)>=0?(t._nearRowsAdded.splice(t._nearRowsAdded.indexOf(a),1),t._add(0,a.data),l&&(t._selection.focusedCell.row=t.rows[0])):t._farRowsAdded&&t._farRowsAdded.indexOf(a)>=0&&(t._farRowsAdded.splice(t._farRowsAdded.indexOf(a),1),t._add(a.data),l&&(t._selection.focusedCell.row=t.rows[t.rows.length-1]))}}t._unboundRows.splice(0,d),t.endUpdate()}}},{key:"saveBatchEdit",value:function(){this._saveBatchEdit()}},{key:"revertBatchEdit",value:function(){this._clearBatchEdit(!0)}},{key:"_endCellEdit",value:function(e){var t=this,i=e||t.editing.editCell;if(!i||i&&!i.isEditing)return null;var n=t._getEditorValue(i);if("invalid value"===n)return i.setAttribute("error",""),!1;var d=t._getEditorId(i);t._cellEditors[d].detach(),i.element.removeAttribute("editor"),i.element.removeAttribute("error"),i.isEditing=!1,i.element.content.innerHTML="";var o=function(){t.editing.editRow||t._recycle(!1)},a=t._cellsUpdatedValues?t._cellsUpdatedValues[i.row.id+"_"+i.column.dataField]:void 0,l=void 0!==a?a:i.value;return!function(e,t){return"date"===i.column.dataType?e.valueOf()===t.valueOf():e===t}(n,l)?(t.editing.editCell=null,t.editing.editRow||(t.editing.isEditing=!1),!0===t.editing.batch||t.editing.batch&&t.editing.batch.indexOf("update")>=0?(t._batchUpdateCell(i.row,i.column,n,i.value),o()):(i._updating=!0,i.value=n,i._updating=!1,o())):(t.editing.editCell=null,t.editing.editRow||(t.editing.isEditing=!1,o())),t.editing.commandColumn.visible&&!t.editing.commandColumn.width&&"cell"===t.editing.mode&&t.refresh(),t.focus(),!0}},{key:"cancelEdit",value:function(){var e=this;if(e.editing.editRow){for(var t=e.editing.editRow.cells,i=0;i<t.length;i++){var n=t[i],d=n.element;d&&(d.removeAttribute("editor"),d.removeAttribute("error"),d.content.innerHTML=""),n.isEditing=!1}e.editing.editRow=null}else e.editing.editCell&&(e.editing.editCell.element.removeAttribute("editor"),e.editing.editCell.element.removeAttribute("error"),e.editing.editCell.element.content.innerHTML="",e.editing.editCell.isEditing=!1,e.editing.editCell=null);e.editing.dialog.visible&&e.editing.dialog.enabled&&e._dialogEdit.close(),e.editing.isEditing=!1,e._recycle(!1),e.editing.commandColumn.visible&&e.refresh(),e.focus()}},{key:"_endRowEdit",value:function(){var e=this,t=e.editing.editRow;if(!t)return!1;for(var i=!0,n=t.cells,d=0;d<n.length;d++){var o=n[d];"invalid value"===e._getEditorValue(o)&&(o.setAttribute("error",""),i=!1)}if(i){for(var a=0;a<n.length;a++){var l=n[a];e._endCellEdit(l)}return e.editing.isEditing=!1,e.editing.editRow=null,e.editing.commandColumn.visible&&!e.editing.commandColumn.width?e.refresh():e._recycle(!1),!0}return e.focus(),!1}},{key:"_batchDeleteRow",value:function(e){var t=this;t._rowsDeleted||(t._rowsDeleted=[]),t._rowsDeleted.push(e),t._recycle(!1)}},{key:"_batchAddRow",value:function(e,t){var i=this;i._rowsAdded||(i._rowsAdded=[]),i._rowsAdded.push(e.id),i.rowById[e.id]=e,e.index=i.rows.length+(i._rowsAdded?i._rowsAdded.length:0),0===t?i._nearRowsAdded.splice(0,0,e):i._farRowsAdded.push(e),i.isInitialized&&i._rowElements&&i._rowElements.length<i.rows.length+i._rowsAdded.length&&i._initializeRowElements(),i.refresh()}},{key:"_batchUpdateCell",value:function(e,t,i,n){var d=this;d._cellsUpdatedValues||(d._cellsUpdatedValues=[]);!function(e,i){return"date"===t.dataType?e.valueOf()===i.valueOf():e===i}(i,n)?d._cellsUpdatedValues[e.id+"_"+t.dataField]=i:delete d._cellsUpdatedValues[e.id+"_"+t.dataField],d._cellsUpdatedValues.length++}},{key:"getBatchEditChanges",value:function(){var e=this,t=[],i=[],n=[];for(var d in e._cellsUpdatedValues){var o=e._cellsUpdatedValues[d],a=d.substring(0,d.indexOf("_")),l=d.substring(d.indexOf("_")+1),r=e.rowById[a],c=r.getCell(l);t.push({id:a,dataField:l,oldValue:c.value,newValue:o})}if(e._rowsDeleted&&e._rowsDeleted.length>0)for(var s=0;s<e._rowsDeleted.length;s++){var u=e._rowsDeleted[s];i.push({id:u.id,data:u})}if(e._rowsAdded&&e._rowsAdded.length>0)for(var m=0;m<e._rowsAdded.length;m++){var v=e._rowsAdded[m];n.push({id:v.id,data:v})}return{updated:t,deleted:i,added:n}}},{key:"_saveBatchEdit",value:function(){var e=this;for(var t in e._cellsUpdatedValues){var i=e._cellsUpdatedValues[t],n=t.substring(0,t.indexOf("_")),d=t.substring(t.indexOf("_")+1),o=e.rowById[n],a=o.getCell(d);a._updating=!0,a.value=i,a._updating=!1}var l=e._rowsDeleted&&e._rowsDeleted.length>0||e._rowsAdded&&e._rowsAdded.length>0;if(l&&e.beginUpdate(),e._rowsAdded&&e._rowsAdded.length>0)for(var r in e._rowsAdded){var c=e._rowsAdded[r],s=e.rowById[c];s&&(e._nearRowsAdded.indexOf(s)>=0?e.rows.splice(0,0,s):e._farRowsAdded.indexOf(s)>=0&&e.rows.push(s))}if(e._rowsDeleted&&e._rowsDeleted.length>0)for(var u=0;u<e._rowsDeleted.length;u++){var m=e._rowsDeleted[u],v=e.rows.indexOf(m);v<0||e.rows.splice(v,1)}l&&e.endUpdate(),e._clearBatchEdit(!1)}},{key:"_clearBatchEdit",value:function(){var e=this,t=!1;e._rowsAdded&&e._rowsAdded.length>0&&(t=!0),e._cellsUpdatedValues=[],e._rowsAdded=[],e._rowsDeleted=[],e._nearRowsAdded=[],e._farRowsAdded=[],t?e.refresh():e._recycle(!1)}},{key:"_getEditorId",value:function(e){return e.editor!==e.column.editor?e.editor.template+"_"+e.column.dataField+"_"+e.row.id:e.editor.template+"_"+e.column.dataField}},{key:"_applyCommand",value:function(e,t){var i=this;t||(t=[]);var n=function(){"function"==typeof e?e.apply(i,t):i[e]?i[e].apply(i,t):JQX[e]?JQX[e].apply(i,t):window[e]&&window[e].apply(i,t)};if(i.onCommand){t||(t=[]),t[1]||(t[1]=null);var d={name:e,command:n,details:t[0],event:t[1],handled:!1};setTimeout(function(){i.onCommand.apply(i,[d]),d.handled||n()},100)}else n()}},{key:"_getCommandColumnCommandsTemplate",value:function(){var e=this,t=e.editing.commandColumn.dataSource,i="icon"!==e.editing.commandColumn.displayMode,n="label"!==e.editing.commandColumn.displayMode,d="";for(var o in t){var a=t[o],l="<div",r=!1;if("commandColumnMenu"!==o){r||(l+=' item="'+o+'" command="'+a.command+'" class="jqx-grid-command-item">',r=!0);var c="{{messages}}"===a.label?e.localize(o):a.label;n&&i?(l+='<span class="jqx-grid-icon '+a.icon+'"></span>',l+='<span class="jqx-grid-label">'+c+"</span>"):n&&!i?l+='<span class="jqx-grid-icon '+a.icon+'"></span>':i&&!n&&(l+='<span class="jqx-grid-label">'+c+"</span>"),l+="</div>",d+=l}}return d}},{key:"_updateCommandColumnCommandsVisibility",value:function(e,t){for(var i=this,n=e.children,d=i.editing.commandColumn.dataSource,o=0;o<n.length;o++){var a=n[o],l=a.getAttribute("item"),r=d[l].visible;!0===r?a.classList.remove("jqx-hidden"):!1===r?a.classList.add("jqx-hidden"):"auto"===r&&(!i.editing.dialog.enabled&&(i.editing.editRow===t||i.editing.editCell&&i.editing.editCell.row===t)?"commandColumnEdit"===l?a.classList.add("jqx-hidden"):"commandColumnUpdate"!==l&&"commandColumnCancel"!==l||n[o].classList.remove("jqx-hidden"):"commandColumnEdit"===l?a.classList.remove("jqx-hidden"):"commandColumnUpdate"!==l&&"commandColumnCancel"!==l||n[o].classList.add("jqx-hidden"))}}},{key:"_handleEditKeyDown",value:function(e){var t=this,i=e.key,n=t.editing.commandKeys;if(!t.editing.dialog.enabled)for(var d in n){var o=n[d],a=o.key.replace(/ /gi,"").split("|");if(a.indexOf(i)>=0){t._applyCommand(o.command);break}}}},{key:"_getCustomCellEditor",value:function(e){var t=this;e.editor.selector=e.editor.template,e.editor.template="custom";var i=t._getEditorId(e);if(!t._cellEditors[i]){var n=document.createElement("div");t._applyCellEditorUserSettings(n,e),n.classList.add("jqx-grid-cell-editor");var d=function(e){if("keydown"===e.type)return void t._handleEditKeyDown(e)},o=function(){var t=e.editor.instance.element.firstElementChild;e.editor.focus?setTimeout(function(){e.editor.focus.apply(e.editor.instance.element,[])},50):setTimeout(function(){t.focus()},50)},a=function(t){var i=e.editor.instance.element.firstElementChild;e.editor.blur?e.editor.blur.apply(e.editor.instance.element,[t]):i.blur()},l=function(t){var i=e.editor.instance.element.firstElementChild;if(e.editor.setValue)e.editor.setValue.apply(e.editor.instance.element,[t]);else{if(i.innerHTML.indexOf("{{")>=0){var n=i.innerHTML.replace(/{{value}}/gi,t).replace(/{{id}}/gi,e.row.id);i.innerHTML=n}i.value=t,t instanceof Date&&(i.value=t.toISOString().split("T")[0]),e.editor.instance.element.value=i.value}},r=function(){var t=e.editor.instance.element.firstElementChild;return e.editor.getValue?e.editor.getValue.apply(e.editor.instance.element,[]):t.value||""},c=function(){n.removeEventListener("keydown",d),e.editor.detach&&e.editor.detach.apply(n,[])},s=function(){n.addEventListener("keydown",d),e.editor.attach&&e.editor.attach.apply(n,[])},u=null;if((e.editor.selector.startsWith("#")||e.editor.selector.startsWith("."))&&(u=document.querySelector(e.editor.selector)),u)n.appendChild(u.content.cloneNode(!0).firstElementChild);else{var m=function(e){var t=document.createElement("template");return e=e.trim(),t.innerHTML=e,t.content.firstChild}(e.editor.selector);m&&n.appendChild(m)}t._cellEditors[i]={element:n,focus:o,blur:a,getValue:r,setValue:l,attach:s,detach:c}}return t._cellEditors[i]}},{key:"_getTextAreaCellEditor",value:function(e){var t=this,i=t._getEditorId(e),n=document.createElement("div"),d=document.createElement("textarea"),o=document.createElement("div");t._applyCellEditorUserSettings(n,e),d.classList.add("jqx-input"),n.classList.add("jqx-grid-cell-editor"),n.classList.add("jqx-grid-text-area-cell-editor"),o.classList.add("nav"),o.classList.add("jqx-icon-resize-full","jqx-grid-icon");var a=function(e){var i=e.key;if("keydown"===e.type)return t._handleEditKeyDown(e),void(e.shiftKey&&" "===i&&(o.click(),e.preventDefault()))};o.onclick=function(){var i=document.createElement("div"),n=document.createElement("span"),a=document.createElement("textarea"),l=e.editor.instance.element,r=document.createElement("div"),c=document.createElement("jqx-scroll-bar");c.orientation="vertical",i.setAttribute("theme",t.theme),r.appendChild(a),r.classList.add("jqx-grid-text-area-container"),r.appendChild(c),a.value=d.value,a.classList.add("jqx-input"),o.textAreaEditorDialog=i,o.popupTextArea=a,n.classList.add("close-button"),n.classList.add("jqx-grid-icon"),n.classList.add("jqx-icon-cancel-circled");var s=function(){c.value=a.scrollTop,c.max=a.scrollHeight-a.offsetHeight,c.onChange=null,a.offsetHeight>=a.scrollHeight?c.classList.add("jqx-hidden"):c.classList.remove("jqx-hidden"),c.onChange=function(){a.scrollTop=c.value}};a.onscroll=function(){s()},a.onkeydown=function(e){"Escape"===e.key&&i.parentNode.removeChild(i),"Enter"===e.key&&e.shiftKey&&n.click()},n.onclick=function(){o.textAreaEditorDialog.parentNode.removeChild(o.textAreaEditorDialog),setTimeout(function(){d.value=a.value,d.select()},50)},i.classList.add("jqx-grid-text-area-dialog"),i.appendChild(r),i.appendChild(n),document.body.appendChild(i),setTimeout(function(){a.select(),s()},50),s(),i.style.top=t._offsetTop(l)+"px",i.style.left=t._offsetLeft(l)+"px",i.style.width=l.offsetWidth+"px"},n.appendChild(d),n.appendChild(o);var l=function(){var e=d.value;return o.textAreaEditorDialog&&o.textAreaEditorDialog.parentNode?(d.value=o.popupTextArea.value,d.value):e},r=function(e){d.value=e},c=function(){setTimeout(function(){d.select()},50)},s=function(){},u=function(){d.addEventListener("keydown",a)},m=function(){d.removeEventListener("keydown",a),o.textAreaEditorDialog&&o.textAreaEditorDialog.parentNode&&(d.value=o.popupTextArea.value,o.textAreaEditorDialog.parentNode.removeChild(o.textAreaEditorDialog))};return t._cellEditors[i]={element:n,focus:c,blur:s,setValue:r,getValue:l,attach:u,detach:m},t._cellEditors[i]}},{key:"_getInputCellEditor",value:function(e){var t=this,i=t._getEditorId(e);if(!t._cellEditors[i]){var n=document.createElement("input");t._applyCellEditorUserSettings(n,e),n.classList.add("jqx-input"),n.classList.add("jqx-grid-cell-editor"),n.classList.add("jqx-grid-input-cell-editor");var d=function(i){if("keydown"===i.type)return"number"!==e.column.dataType&&"int"!==e.column.dataType&&"float"!==e.column.dataType||i.key.match(/[0-9]/)||"-"===i.key||1!==i.key.length?void t._handleEditKeyDown(i):(i.preventDefault(),void i.stopPropagation())},o=function(){setTimeout(function(){n.select()},50)},a=function(){},l=function(t){if("number"===e.column.dataType||"int"===e.column.dataType||"float"===e.column.dataType){if(""===t)return;if(t&&!t.toString().match(/[0-9]/)&&"-"!==t)return}n.value=t},r=function(){return n.value},c=function(){n.removeEventListener("keydown",d)},s=function(){n.addEventListener("keydown",d)};t._cellEditors[i]={element:n,focus:o,blur:a,getValue:r,setValue:l,attach:s,detach:c}}return t._cellEditors[i]}},{key:"_applyCellEditorUserSettings",value:function(e,t){for(var i in t.editor)"template"!==i&&("list"!==i?e[i]=t.editor[i]:e.setAttribute(i,t.editor[i]))}},{key:"_getAutoCompleteCellEditor",value:function(e){var t=this,i=t._getEditorId(e);if(!t._cellEditors[i]){var n=document.createElement("jqx-input");t._applyCellEditorUserSettings(n,e);var d=function(e){if(!n.opened)return"keydown"===e.type?void t._handleEditKeyDown(e):void 0};n.classList.add("jqx-grid-cell-editor"),n.classList.add("jqx-grid-auto-complete-cell-editor");var o=function(){setTimeout(function(){n&&n.select&&n.select()},50)},a=function(e){n.value=e},l=function(){return n.value},r=function(){n&&n.close&&(n.value="",n.close(),n.removeEventListener("keydown",d))},c=function(){},s=function(){n.addEventListener("keydown",d)};t._cellEditors[i]={element:n,focus:o,blur:c,setValue:a,getValue:l,attach:s,detach:r}}for(var u=t.getVisibleRows(),m=[],v=0;v<u.length;v++){var f=t.dataSource[u[v].index];f&&(f=f[e.column.dataField],-1===m.indexOf(f)&&m.push(f))}return t._cellEditors[i].element.dataSource=m,t._cellEditors[i]}},{key:"_getDateTimePickerCellEditor",value:function(e){var t=this,i=t._getEditorId(e);if(!t._cellEditors[i]){var n=document.createElement("jqx-date-time-picker");n.calendarButton=!0,n.dropDownAppendTo="body",n.autoClose=!0,n.dropDownDisplayMode="calendar",t._applyCellEditorUserSettings(n,e);var d=function(e){if(!n.opened)return"keydown"===e.type?void t._handleEditKeyDown(e):void 0};n.classList.add("jqx-grid-cell-editor"),n.classList.add("jqx-grid-date-time-picker-cell-editor");var o=function(){setTimeout(function(){n.select()},50)},a=function(e){n.value=e},l=function(){return n.value},r=function(){n.value="",n.close(),n.removeEventListener("keydown",d)},c=function(e){var i=n.getAttribute("aria-controls");if(i&&n.opened){var d=t.getBoundingRect(document.getElementById(i));e.pageX<d.left||e.pageX>d.right||e.pageY<d.top||e.pageY>d.bottom||e.preventDefault()}},s=function(){n.addEventListener("keydown",d)};t._cellEditors[i]={element:n,focus:o,blur:c,setValue:a,getValue:l,attach:s,detach:r}}return t._cellEditors[i]}},{key:"_getNumberInputCellEditor",value:function(e){var t=this,i=t._getEditorId(e);if(!t._cellEditors[i]){var n=document.createElement("div"),d=document.createElement("input"),o=document.createElement("div"),a=document.createElement("div"),l=document.createElement("div");t._applyCellEditorUserSettings(n,e),a.tabIndex=l.tabIndex=0,d.classList.add("jqx-input"),n.classList.add("jqx-grid-cell-editor"),n.classList.add("jqx-grid-number-input-cell-editor"),o.classList.add("nav"),a.classList.add("up"),l.classList.add("down");var r=function(e){if("keydown"===e.type)return void t._handleEditKeyDown(e)};d.type="number",o.appendChild(a),o.appendChild(l),n.appendChild(d),n.appendChild(o);var c=function(){var e=parseFloat(d.value);return isNaN(e)||e===1/0||e===-1/0?0:e},s=function(e){d.value=e},u=function(){setTimeout(function(){d.select()},50)},m=function(){},v=function(){d.addEventListener("keydown",r),a.onkeydown=r,l.onkeydown=r,a.onclick=function(){var e=parseFloat(d.value);(e<d.max||""===d.max)&&(d.value=e+1)},l.onclick=function(){var e=parseFloat(d.value);(e>d.min||""===d.min)&&(d.value=e-1)}},f=function(){d.removeEventListener("keydown",r),a.onclick=l.onclick=null,a.onkeydown=l.onkeydown=null};t._cellEditors[i]={element:n,focus:u,blur:m,setValue:s,getValue:c,attach:v,detach:f}}return t._cellEditors[i]}},{key:"_getCheckBoxCellEditor",value:function(e){var t=this,i=t._getEditorId(e);if(!t._cellEditors[i]){var n=document.createElement("div");n.classList.add("jqx-input"),n.classList.add("jqx-grid-cell-editor"),n.classList.add("jqx-grid-check-box-cell-editor"),n.tabIndex=0;var d=function(){!0!==n.value&&!1!==n.value&&null!==n.value&&(n.value=!1),null===n.value?n.value=!1:n.value=!n.value,!1===n.value?n.removeAttribute("checked"):n.setAttribute("checked",n.value?"":"indeterminate")},o=function(e){t._handleEditKeyDown(e)},a=function(e){n.value=e,!1===n.value?n.removeAttribute("checked"):n.setAttribute("checked",n.value?"":"indeterminate")},l=function(){n.focus(),setTimeout(function(){n.focus()},25)},r=function(){return n.value},c=function(){n.value=!1,n.removeEventListener("click",d),n.removeEventListener("keydown",o)},s=function(){},u=function(){n.addEventListener("keydown",o),n.addEventListener("click",d)};t._cellEditors[i]={getValue:r,setValue:a,focus:l,blur:s,element:n,detach:c,attach:u}}return t._cellEditors[i]}},{key:"_getEditorValue",value:function(e){var t=this,i=t._getEditorId(e);if(t._cellEditors){var n=t._cellEditors[i];if(n){var d=function(t){switch(e.column.dataType){case"float":case"int":case"number":t="int"===e.column.dataType?parseInt(t):parseFloat(t),isNaN(t)&&(t=0);break;case"bool":case"boolean":"true"!==t&&"1"!==t||(t=!0),"false"!==t&&"0"!==t||(t=!1);break;case"date":t=new JQX.Utilities.DateTime(t),t=t.toDate();break;case"dateTime":t=new JQX.Utilities.DateTime(t)}return t},o=null;switch(e.editor.template){case"input":case"autoComplete":case"numberInput":case"deteTimePicker":case"checkBox":try{o=d(n.getValue())}catch(t){o=e.value}if(e.editor.getValue){var a=e.editor.getValue(e,o);void 0!==a&&(o=a)}break;default:o=d(n.getValue())}var l=!0;return e.column.validator&&(l=e.column.validator.evaluate(o)),l?o:"invalid value"}}}},{key:"_beginRowEdit",value:function(e,t){var i=this;if(e===i.editing.editRow)return!1;if(i.editing.editRow){if(!i.endEdit())return!1}var n=e.cells;i.editing.editRow=e,i.editing.commandColumn.visible&&(i.editing.isEditing=!1,i.refresh(),i.editing.isEditing=!0),e.isEditing=!0;for(var d=!1,o=0;o<n.length;o++){var a=n[o],l=i._beginCellEdit(a);t?a===t&&a.editor.instance.focus():l&&!d&&(d=!0,a.editor.instance.focus()),i.editing.commandColumn.visible&&a.column.commandColumn&&a.render()}return!0}},{key:"_createDialog",value:function(){var e=this,t=document.createElement("div");t.setAttribute("animation","none"),t.classList.add("jqx-window","jqx-grid-dialog"),t.style.width=e.editing.dialog.width,t.style.height=e.editing.dialog.height,t.style.left="",t.style.top="",t.innerHTML='<div class="jqx-container">\n                        <div id="headerSection" class="jqx-header-section">\n                            <div class="jqx-header"></div>\n                            <div class="jqx-buttons-container">\n                                <jqx-button unfocusable class="jqx-close-button"></jqx-button>\n                            </div>\n                        </div>\n                        <div class="jqx-content"><div></div></div>\n                        <div class ="jqx-footer">\n                            <div class ="jqx-stack-layout right spacing">\n                                <jqx-button class ="jqx-confirm-button item primary">Ok</jqx-button>\n                                <jqx-button class ="jqx-cancel-button item">Cancel</jqx-button>\n                            </div>\n                        </div>\n                    </div>',t.content=t.querySelector(".jqx-content").firstChild,t.footer=t.querySelector(".jqx-footer"),t.header=t.querySelector(".jqx-header"),t.btnConfirm=t.querySelector(".jqx-confirm-button"),t.btnCancel=t.querySelector(".jqx-cancel-button"),t.btnClose=t.querySelector(".jqx-close-button");var i=document.createElement("div");return i.classList.add("jqx-grid-dialog-overlay"),i.onclick=function(){},t.overlay=i,t.remove=function(){t.parentNode&&t.parentNode.removeChild(t)},t.close=function(){t.classList.remove("open"),t.addEventListener("transitionend",t.remove),t.addEventListener("transitioncancel",t.remove),t.modal&&t.overlay.parentNode&&t.overlay.parentNode.removeChild(t.overlay),t.onClose&&t.onClose()},t.open=function(i,n){t.removeEventListener("transitionend",t.remove),t.removeEventListener("transitioncancel",t.remove),document.body.appendChild(t),i||(i=e.editing.dialog.left),n||(n=e.editing.dialog.top),requestAnimationFrame(function(){t.classList.add("open");var d=function(i,n){var d=e.offset(e);switch("center"===i&&"horizontal"===n&&(i="middle"),i){case"top":return d.top;case"bottom":return d.top+e.offsetHeight-t.offsetHeight;case"center":return d.top+e.offsetHeight/2-t.offsetHeight/2;case"left":return d.left;case"middle":return d.left+e.offsetWidth/2-t.offsetWidth/2;case"right":return d.left+e.offsetWidth-t.offsetWidth}return"horizontal"===n?parseInt(i)+d.left:"vertical"===n?parseInt(i)+d.top:"number"==typeof i?i:parseInt(i)};t.style.left=d(i,"horizontal")+"px",t.style.top=d(n,"vertical")+"px"}),t.modal&&e.appendChild(t.overlay),t.onOpen&&t.onOpen()},t}},{key:"_openAddRowDialog",value:function(e,t){var i=this;if(!i.editing.addDialog.enabled)return!1;var n=i._dialogAddRow||i._createDialog(),d="{{message}}"===i.editing.dialog.header?i.localize("dialogAddHeader"):i.editing.dialog.header,o=n.content;n.header.innerHTML=d,e.grid=i,void 0===e.index&&(e.index=i.rows.length,i._rowsAdded&&(e.index+=i._rowsAdded.length));var a=e.cells,l=null,r=0;if(i._cellEditors||(i._cellEditors=[]),!i._dialogAddRow){n.modal=!0,n.btnConfirm.innerHTML=i.localize("dialogAddButtonConfirm"),n.btnCancel.innerHTML=i.localize("dialogAddButtonCancel"),n.onOpen=function(){i.editing.dialog.visible=!0},n.onClose=function(){i.editing.dialog.visible=!1},n.btnCancel.onclick=function(){n.close()},n.btnClose.onclick=function(){n.close()},n.btnConfirm.onclick=function(){for(var e={},d=0;d<a.length;d++){var o=a[d],l=i._getEditorValue(o),r=i._getEditorId(o),c=i._cellEditors[r];e[o.column.dataField]=l,c.detach()}var s=i._rowsAdded?i._rowsAdded.length:0,u=new JQX.Grid.Row({index:i.rows.length+s,grid:i,data:e});n.close(),t(u,0===n.index)},n.onkeydown=function(e){var t=e.key;"Enter"===t?n.btnConfirm.onclick():"Escape"===t&&n.close()},o.classList.add("jqx-grid-layout");for(var c=0;c<i.columns.length;c++){var s=i.columns[c];if(s.allowEdit){r%2==0&&(l=document.createElement("div"),l.classList.add("row"),o.appendChild(l));var u=document.createElement("div");u.classList.add("col-sm-6");var m=document.createElement("div");m.classList.add("column");var v=document.createElement("label");v.innerHTML=i.columns[c].label;var f=document.createElement("div");f.classList.add("jqx-grid-dialog-editor"),f.setAttribute("editor",s.dataField),f.setAttribute("template",s.editor.template),u.appendChild(m),l.appendChild(u),m.appendChild(v),m.appendChild(f),r++}}}n.open(),n.index=e.index;for(var g=0;g<a.length;g++){var p=a[g],w=p.column,h=w.dataField,_=n.querySelector("[editor="+h+"]");_.innerHTML="";var C="";void 0!==p.value?C=p.value:("int64"!==w.dataType&&"number"!==w.dataType&&"int"!==w.dataType&&"float"!==w.dataType||(C=0),"date"===w.dataType&&(C=new Date),"bool"!==w.dataType&&"boolean"!==w.dataType||(C=!1));var E=null;switch(p.editor.template){default:case"custom":E=i._getCustomCellEditor(p);break;case"checkBox":E=i._getCheckBoxCellEditor(p);break;case"autoComplete":E=i._getAutoCompleteCellEditor(p);break;case"dateTimePicker":E=i._getDateTimePickerCellEditor(p);break;case"textArea":E=i._getTextAreaCellEditor(p);break;case"numberInput":case"input":E="numberInput"===p.editor.template?i._getNumberInputCellEditor(p):i._getInputCellEditor(p)}E.attach(),p.editor.instance=E,E.setValue(C),0===g&&E.focus(),p.editor.isInitialized||(p.editor.isInitialized=!0,p.editor.onInit&&p.editor.onInit(p.row.index,p.column.dataField,p.editor.instance.element)),p.editor.onRender&&p.editor.onRender(p.row.index,p.column.dataField,p.editor.instance.element),_.appendChild(E.element)}i._dialogAddRow=n}},{key:"_openEditDialog",value:function(e,t){var i=this;if(!i.editing.dialog.enabled)return!1;var n=i._dialogEdit||i._createDialog(),d="{{message}}"===i.editing.dialog.header?i.localize("dialogEditHeader",{value:i.editing.editRow?e.row.visibleIndex+1:e.column.label}):i.editing.dialog.header,o=n.content;n.header.innerHTML=d;var a=null,l=0;if(!i._dialogEdit)if(n.modal=!0,n.btnConfirm.innerHTML=i.localize("dialogEditButtonConfirm"),n.btnCancel.innerHTML=i.localize("dialogEditButtonCancel"),n.onOpen=function(){i.editing.dialog.visible=!0},n.onClose=function(){i.editing.dialog.visible=!1},n.btnCancel.onclick=function(){i.cancelEdit()},n.btnClose.onclick=function(){i.cancelEdit()},n.btnConfirm.onclick=function(){i.endEdit()},n.onkeydown=function(e){var t=e.key,n=i.editing.commandKeys;for(var d in n){var o=n[d];if(t===o.key){i._applyCommand(o.command);break}}},i.editing.editRow){o.classList.add("jqx-grid-layout");for(var r=0;r<i.columns.length;r++){var c=i.columns[r];if(c.allowEdit){l%2==0&&(a=document.createElement("div"),a.classList.add("row"),o.appendChild(a));var s=document.createElement("div");s.classList.add("col-sm-6");var u=document.createElement("div");u.classList.add("column");var m=document.createElement("label");m.innerHTML=i.columns[r].label;var v=document.createElement("div");v.classList.add("jqx-grid-dialog-editor"),v.setAttribute("editor",c.dataField),v.setAttribute("template",c.editor.template),s.appendChild(u),a.appendChild(s),u.appendChild(m),u.appendChild(v),l++}}}else{var f=e.column,g=document.createElement("div");g.classList.add("jqx-grid-dialog-editor"),g.setAttribute("editor",""),g.setAttribute("template",f.editor.template),o.appendChild(g)}if(n.open(),i.editing.editRow){var p=n.querySelector("[editor="+e.column.dataField+"]");p.innerHTML="",p.appendChild(t.element)}else{var w=e.column,h=n.querySelector("[editor]");h.innerHTML="",h.setAttribute("template",w.editor.template),h.appendChild(t.element)}i._dialogEdit=n}},{key:"_openDeleteRowDialog",value:function(e,t){var i=this
;if(!i.editing.deleteDialog.enabled)return!1;var n=i._dialogDelete||i._createDialog(),d="{{message}}"===i.editing.dialog.header?i.localize("dialogDeleteHeader",{value:e.visibleIndex+1}):i.editing.dialog.header;n.header.innerHTML=d,n.content.innerHTML=i.localize("dialogDeleteContent"),n.row=e,i._dialogDelete||(n.modal=!0,n.btnConfirm.innerHTML=i.localize("dialogDeleteButtonConfirm"),n.btnCancel.innerHTML=i.localize("dialogDeleteButtonCancel"),n.onOpen=function(){i.editing.dialog.visible=!0},n.onClose=function(){i.editing.dialog.visible=!1},n.btnCancel.onclick=function(){n.close()},n.btnClose.onclick=function(){n.close()},n.btnConfirm.onclick=function(){t(n.row),n.close()},n.onkeydown=function(e){"Escape"===e.key&&n.close()},i._dialogDelete=n),n.open(),setTimeout(function(){n.btnConfirm.focus()},100)}},{key:"_beginCellEdit",value:function(e,t){var i=this;if(e.isEditing)return!1;if(!e.column.allowEdit||e.column.autoGenerated||e.readonly)return!1;if(i.editing.editCell&&!i.editing.editRow){if(!1===i._endCellEdit())return!1}i._cellEditors||(i._cellEditors=[]),i.editing.editRow||(i.editing.editCell=e),i.editing.commandColumn.visible&&!i.editing.editRow&&(i.editing.isEditing=!1,i.refresh(),i.editing.isEditing=!0),i.editing.isEditing=!0,i._selection.selectionRect&&i._selection.selectionRect.classList.add("jqx-visibility-hidden");var n=function(t){var n=t.element;i.editing.dialog.enabled?i._openEditDialog(e,t):(e.element.setAttribute("editor","string"==typeof e.editor.template?e.editor.template:"template"),e.element.content.innerHTML="",e.element.content.appendChild(n),i.editing.editRow&&e.element.setAttribute("row-editor","")),t.attach(),e.editor.instance=t,e.isEditing=!0},d=i._cellsUpdatedValues?i._cellsUpdatedValues[e.row.id+"_"+e.column.dataField]:void 0,o=void 0!==d?d:e.value;if(void 0===o){o="";var a=e.column;"number"===a.dataType||"int"===a.dataType||"float"===a.dataType?o=0:"date"===a.dataType&&(o=new Date,o.setTime(0,0,0))}switch(e.editor.template){default:case"custom":var l=i._getCustomCellEditor(e);n(l),l.setValue(o);break;case"checkBox":var r=i._getCheckBoxCellEditor(e);n(r);var c=!0===o||1===o;if("checkBox"===e.template&&t){document.elementsFromPoint(t.clientX,t.clientY)[0].classList.contains("jqx-input")?r.setValue(!c):r.setValue(c)}else r.setValue(c);break;case"autoComplete":var s=i._getAutoCompleteCellEditor(e);n(s),s.setValue(o),e.editor.autoOpen&&s.element.open();break;case"dateTimePicker":var u=i._getDateTimePickerCellEditor(e);n(u),u.setValue(o),e.editor.autoOpen&&u.element.open();break;case"textArea":var m=i._getTextAreaCellEditor(e);n(m),m.setValue(o);break;case"numberInput":case"input":var v="numberInput"===e.editor.template?i._getNumberInputCellEditor(e):i._getInputCellEditor(e);n(v),v.setValue(o)}return e.editor.isInitialized||(e.editor.isInitialized=!0,e.editor.onInit&&e.editor.onInit(e.row.index,e.column.dataField,e.editor.instance.element)),e.editor.onRender&&e.editor.onRender(e.row.index,e.column.dataField,e.editor.instance.element),i.editing.editCell&&e.editor.instance.focus(),!0}},{key:"_onCellClick",value:function(e,t){var i=this;if(e.row.addNewRow)return void("far"===e.row.freeze?i._insertNewRowAfter():i._insertNewRowBefore());if(i.editing.enabled){if(i.editing.commandColumn.visible)if(e.column.commandColumn){for(var n=document.elementsFromPoint(t.pageX,t.pageY),d=null,o=0;o<n.length;o++)if(n[o].classList.contains("jqx-grid-command-item")){d=n[o];break}if(d||(d=e.element.querySelector(".jqx-grid-command-item")),d){var a=d.getAttribute("command");return void i._applyCommand(a,[e.row,t])}}else if(i.editing.commandColumn.inline)for(var l=document.elementsFromPoint(t.pageX,t.pageY),r=0;r<l.length;r++)if(l[r].classList.contains("jqx-grid-command-item"))return;if("none"===i.editing.action&&i.editing.isEditing){var c=!1;i.editing.editCell&&i.editing.editCell.row!==e.row&&(c=!0),i.editing.editRow&&i.editing.editRow!==e.row&&(c=!0),c&&i.endEdit()}if("click"===i.editing.action&&(!i.selection.enabled||e.selected))if("cell"===i.editing.mode){var s=e.parent();s?i._beginCellEdit(s,t):i._beginCellEdit(e,t)}else"row"===i.editing.mode&&i._beginRowEdit(e.row,e,t)}}},{key:"_onCellDoubleClick",value:function(e,t){var i=this;i.editing.enabled&&("doubleClick"!==i.editing.action||i.editing.isEditing||("cell"===i.editing.mode?i._beginCellEdit(e,t):"row"===i.editing.mode&&i._beginRowEdit(e.row,e,t)))}},{key:"_onRowClick",value:function(){}},{key:"_onRowDoubleClick",value:function(){}}]),e}());
//# sourceMappingURL=jqxgrid.edit.js.map
