"use strict";JQX("jqx-file-upload",function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"template",value:function(){return'<div id="container">\n                    <div id="fileUploadHeader" class ="jqx-file-upload-header">\n                        <jqx-button class ="jqx-browse-button" id="browseButton" disabled="[[disabled]]" theme="[[theme]]"></jqx-button>\n                        <input type="file" class ="jqx-browse-input" id="browseInput" name="[[name]]" animation="[[animation]]" disabled="[[disabled]]" unfocusable="[[unfocusable]]" multiple="[[multiple]]" webkitdirectory="[[directory]]" mozdirectory="[[directory]]" />\n                    </div>\n                    <div id="fileUploadContainer" class ="jqx-file-upload-container">\n                        <div id="dropZone" class ="jqx-drop-zone"></div>\n                        <div id="selectedFiles" class ="jqx-selected-files"></div>\n                    </div>\n                    <div id="totalFiles" class ="jqx-total-files jqx-hidden">Total flies: 0</div>\n                    <div id="fileUploadFooter" class ="jqx-file-upload-footer jqx-hidden">\n                        <jqx-button class ="jqx-upload-all-button success" id="uploadAllButton" animation="[[animation]]" disabled="[[disabled]]" unfocusable="[[unfocusable]]"" theme="[[theme]]"></jqx-button>\n                        <jqx-button class ="jqx-cancel-all-button error" id="cancelAllButton" animation="[[animation]]" disabled="[[disabled]]" unfocusable="[[unfocusable]]" theme="[[theme]]"></jqx-button>\n                        <jqx-button class ="jqx-pause-all-button primary" id="pauseAllButton" animation="[[animation]]" disabled="[[disabled]]" unfocusable="[[unfocusable]]" theme="[[theme]]"></jqx-button>\n                    </div>\n                </div>'}},{key:"propertyChangedHandler",value:function(e,l,i){var a=this;switch(babelHelpers.get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"propertyChangedHandler",this).call(this,e,l,i),e){case"accept":a.$.browseInput.accept=i;break;case"dropZone":case"appendTo":a._handleContainers();break;case"messages":case"locale":a._updateTextValues();break;case"multiple":a.$.browseButton.disabled=!!(!a.multiple&&a._selectedFiles.length>0||a.disabled),!i&&a._selectedFiles.length>1&&(a._selectedFiles.splice(1),a._renderSelectedFiles());break;case"itemTemplate":a._items.length>0&&(a._renderSelectedFiles(),a._handleComponentsByAvailableHeight())}}},{key:"attached",value:function(){babelHelpers.get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"attached",this).call(this),this._handleContainers()}},{key:"detached",value:function(){babelHelpers.get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"detached",this).call(this);var e=this;e.$.fileUploadContainer.contains(e.$.dropZone)||e.$.fileUploadContainer.insertBefore(e.$.dropZone,e.$.fileUploadContainer.firstChild),e.$.fileUploadContainer.contains(e.$.selectedFiles)||e.$.fileUploadContainer.appendChild(e.$.selectedFiles)}},{key:"ready",value:function(){babelHelpers.get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"ready",this).call(this);var e=this;e._setInitialValues(),e._updateTextValues(),e._handleContainers(),e._handleComponentsByAvailableHeight()}},{key:"browse",value:function(){var e=this;e.disabled||!e.multiple&&e._selectedFiles.length>0||e.$.browseInput.click()}},{key:"cancelAll",value:function(){var e=this;if(!e.disabled&&0!==e._items.length){for(var t=e._items.length-1;t>=0;t--)e.cancelFile(e._items[t].index);e.$.browseButton.disabled=!!(!e.multiple&&e._selectedFiles.length>0||e.disabled)}}},{key:"cancelFile",value:function(e){var t=this;if("number"==typeof e&&!t.disabled&&0!==t._selectedFiles.length){var l=t._getFileItem(e,!0);if(!l)return void t.error(t.localize("wrongItemIndex",{elementType:t.nodeName.toLowerCase()}));var i=t._items.indexOf(l);t.$.selectedFiles.removeChild(l),l&&l.xhr&&l.xhr.abort(),t._selectedFiles.splice(i,1),t._items.splice(i,1),t.$.fireEvent("uploadCanceled",{filename:l.file.name,type:l.file.type,size:l.file.size,index:l.index}),t.$.browseButton.disabled=!!(!t.multiple&&t._selectedFiles.length>0||t.disabled),0===t._selectedFiles.length&&t.$.fileUploadFooter.classList.add("jqx-hidden"),t._handleComponentsByAvailableHeight()}}},{key:"pauseAll",value:function(){var e=this;if(!e.disabled&&0!==e._items.length)for(var t=e._items.length-1;t>=0;t--){var l=e._items[t];l.xhr&&l.xhr.abort()}}},{key:"pauseFile",value:function(e){var t=this;if(!("number"!=typeof e&&"string"!=typeof e||t.disabled||0===t._items.length)){var l=t._getFileItem(e,!0);if(!l)return void t.error(t.localize("wrongItemIndex",{elementType:t.nodeName.toLowerCase()}));l.classList.remove("jqx-uploading-start"),l&&l.xhr&&l.xhr.abort(),t.$.fireEvent("uploadPaused",{filename:l.file.name,type:l.file.type,size:l.file.size,index:l.index})}}},{key:"uploadAll",value:function(){var e=this;if(!e.disabled&&0!==e._items.length)for(var t=e._items.length-1;t>=0;t--)e._items[t].uploading||e.uploadFile(e._items[t].index)}},{key:"uploadFile",value:function(e){var t=this,l=!1;if("number"==typeof e&&!t.disabled&&0!==t._selectedFiles.length){var i=t._getFileItem(e,!0);if(i){var a=new FormData,n=t.showProgress?i.getElementsByTagName("jqx-progress-bar")[0]:null,s=i.file;i.classList.remove("jqx-pause","jqx-error"),i.classList.add("jqx-uploading-start"),a.append("userfile[]",s);var o=new XMLHttpRequest;o.open("POST",t.uploadUrl),t.setHeaders&&"function"==typeof t.setHeaders&&t.setHeaders(o,s),t.$.fireEvent("uploadStarted",{filename:i.file.name,type:i.file.type,size:i.file.size,index:i.index}),o.upload.onprogress=function(e){l||(l=!0,i.classList.remove("jqx-uploading-start"),i.classList.add("jqx-uploading"),i.uploading=!0,i.xhr=o),n&&(n.value=Math.round(e.loaded/e.total*100)),i.classList.remove("jqx-pause","jqx-error")},o.onabort=function(){i.classList.remove("jqx-uploading-start","jqx-uploading"),i.classList.add("jqx-pause"),i.addEventListener("animationend",function(){i.classList.remove("jqx-pause","jqx-error")})},o.onerror=function(){i.classList.remove("jqx-uploading-start","jqx-uploading"),i.classList.add("jqx-error"),i.addEventListener("animationend",function(){i.classList.remove("jqx-pause","jqx-error")})},o.onload=function(){if(l=!1,i.classList.remove("jqx-uploading-start","jqx-uploading"),o.status>=200&&o.status<=299){var e=t._items.indexOf(i);t.$.selectedFiles.removeChild(i),t._selectedFiles.splice(t._selectedFiles.indexOf(s),1),t._items.splice(e,1),t.$.browseButton.disabled=!!(!t.multiple&&t._selectedFiles.length>0||t.disabled),t.$.fireEvent("uploadCompleted",{filename:i.file.name,type:i.file.type,size:i.file.size,status:o.status,index:i.index}),0===t._selectedFiles.length&&t.$.fileUploadFooter.classList.add("jqx-hidden")}else i.classList.add("jqx-error"),i.classList.remove("jqx-uploading"),t.$.fireEvent("uploadError",{filename:i.file.name,type:i.file.type,size:i.file.size,status:o.status,index:i.index})},o.onreadystatechange=function(){t.responseHandler&&"function"==typeof t.responseHandler&&t.responseHandler(o)},o.send(a)}}}},{key:"_selectedFilesClickHandler",value:function(e){var t=this;if(!t.disabled){var l=e.target,i=l.closest(".jqx-item-upload-button"),a=l.closest(".jqx-item-cancel-button"),n=l.closest(".jqx-item-pause-button"),s=l.closest(".jqx-file");i?t.uploadFile(s.index):a?t.cancelFile(s.index):n&&t.pauseFile(s.index)}}},{key:"_browseInputChangeHandler",value:function(){var e=this,t=e._filterNewFiles(Array.from(e.$.browseInput.files)),l=[];e.disabled||0===t.length||(l=e.validateFile&&"function"==typeof e.validateFile?t.filter(function(t){return!!e.validateFile(t)||(e.$.fireEvent("validationError",{filename:t.name,type:t.type,size:t.size}),!1)}):t,e._selectedFiles=e._selectedFiles.concat(l),0!==e._selectedFiles.length&&(e._renderSelectedFiles(l),e.$.browseButton.disabled=!!(!e.multiple&&e._selectedFiles.length>0||e.disabled),e.$.browseInput.value="",e.autoUpload&&e.uploadAll()))}},{key:"_defaultItemTemplate",value:function(e){var t=this;return'<span class ="jqx-item-name">'+e+'</span>\n                <span class ="jqx-item-upload-button" title="'+t.localize("uploadFile")+'"></span>\n                <span class ="jqx-item-cancel-button" title="'+t.localize("cancelFile")+'"></span>\n                <span class ="jqx-item-pause-button" title="'+t.localize("pauseFile")+'"></span>\n                <jqx-progress-bar></jqx-progress-bar>'}},{key:"_dropZoneHandler",value:function(e){var t=this;if(e.preventDefault(),e.stopPropagation(),!t.disabled){if("dragenter"===e.type||"dragleave"===e.type)return void("dragenter"===e.type?t.$.dropZone.classList.add("jqx-drag-over"):t.$.dropZone.classList.remove("jqx-drag-over"));if("drop"===e.type){if(t.$.dropZone.classList.remove("jqx-drag-over"),!t.multiple&&t._selectedFiles.length>0)return;if(e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length){var l=t._filterNewFiles(Array.from(e.dataTransfer.files));if(0===l.length)return;t.multiple||l.splice(1),t._selectedFiles=t._selectedFiles.concat(l),t._renderSelectedFiles(l)}t.$.browseButton.disabled=!!(!t.multiple&&t._selectedFiles.length>0||t.disabled)}}}},{key:"_filterNewFiles",value:function(e){for(var t=this,l=[],i=0;i<e.length;i++){for(var a=!0,n=0;n<t._selectedFiles.length;n++){var s=t._selectedFiles[n],o=e[i];if(o.name===s.name&&o.size===s.size&&o.type===s.type&&o.lastModified===s.lastModified){a=!1;break}}a&&l.push(e[i])}return l}},{key:"_getFileItem",value:function(e,t){var l=this,i=null;if(e&&("string"==typeof e||"number"==typeof e)){if(!l._items||0===l._items.length)return null;for(var a=0;a<l._items.length;a++){var n=l._items[a];(t&&n.index===parseInt(e)||n.file.name===e)&&(i=n)}return i}}},{key:"_handleContainers",value:function(){var e=this,t=e._validateDOMElement(e.dropZone),l=e._validateDOMElement(e.appendTo);t?t.appendChild(e.$.dropZone):e.$.fileUploadContainer.insertBefore(e.$.dropZone,e.$.fileUploadContainer.firstChild),l?l.appendChild(e.$.selectedFiles):e.$.fileUploadContainer.appendChild(e.$.selectedFiles)}},{key:"_handleItemTemplate",value:function(e){var t=this,l=t.itemTemplate;if(!("content"in document.createElement("template")))return void t.error(t.localize("htmlTemplateNotSuported",{elementType:t.nodeName.toLowerCase()}));if(!l)return t._defaultItemTemplate(e);if("string"==typeof l&&(l=document.getElementById(l)),null===l||!("content"in l))return void t.error(t.localize("invalidTemplate",{elementType:t.nodeName.toLowerCase(),property:"template"}));var i=l.innerHTML,a=/{{\w+}}/g;return i.replace(a,e)}},{key:"_renderSelectedFiles",value:function(e){var t=this,l=document.createDocumentFragment(),i=e||t._selectedFiles;e||(t._items=[],t.$.selectedFiles.innerHTML="");for(var a=0;a<i.length;a++){var n=t.directory?i[a].webkitRelativePath:i[a].name,s=document.createElement("div");t._incrementIndex++,s.className="jqx-file",s.index=t._incrementIndex,s.setAttribute("item-id",t._incrementIndex),s.innerHTML=t.itemTemplate?t._handleItemTemplate(n):t._defaultItemTemplate(n),s.file=i[a],s.uploading=!1,s.xhr=null,l.appendChild(s),t._items.push(s),t.$.fireEvent("fileSelected",{filename:i[a].name,type:i[a].type,size:i[a].size,index:s.index})}t.$.selectedFiles.appendChild(l),t.$.fileUploadFooter.classList.remove("jqx-hidden"),t._handleComponentsByAvailableHeight()}},{key:"_setInitialValues",value:function(){var e=this;e.$.browseInput.accept=e.accept,e._selectedFiles=[],e._items=[],e._incrementIndex=0}},{key:"_updateTextValues",value:function(){for(var e=this,t=["browse","uploadAll","cancelAll","pauseAll"],l=0;l<t.length;l++){var i=t[l],a=i+"Button";e.$[a].innerHTML=e.localize(i)}for(var n=0;n<e._selectedFiles.length;n++){var s=e._items[n];s.querySelector(".jqx-item-upload-button").title=e.localize("uploadFile"),s.querySelector(".jqx-item-cancel-button").title=e.localize("cancelFile"),s.querySelector(".jqx-item-pause-button").title=e.localize("pauseFile")}}},{key:"_validateDOMElement",value:function(e){if(e)return"string"==typeof e?document.getElementById(e):e instanceof HTMLElement?e:void 0}},{key:"_handleComponentsByAvailableHeight",value:function(){var e=this;if(e._calculateAvailableContainerHeight(),e._elementsAutoHeight>e.offsetHeight){if(e.$.container.classList.add("jqx-overflow"),e._containerOverflows=!0,e._rowHeight){for(var t=parseInt(e._availableHeight/e._rowHeight),l=0;l<e._items.length;l++){var i=e._items[l];l<t?i.classList.remove("jqx-hidden"):i.classList.add("jqx-hidden")}e._items.length>t?(e.$.totalFiles.innerHTML=e.localize("totalFiles")+e._items.length,e.$.totalFiles.classList.remove("jqx-hidden")):e.$.totalFiles.classList.add("jqx-hidden")}}else""===e.dropZone&&e._elementsAutoHeight<e.offsetHeight&&(e.$.container.classList.remove("jqx-overflow"),e._containerOverflows=!1)}},{key:"_calculateAvailableContainerHeight",value:function(){var e=this,t=window.getComputedStyle(e.$.fileUploadContainer,null),l=parseInt(t.getPropertyValue("margin-top"))+parseInt(t.getPropertyValue("margin-bottom"))+parseInt(t.getPropertyValue("padding-top"))+parseInt(t.getPropertyValue("padding-bottom")),i=e.$.container.querySelector(".jqx-file"),a=e.$.fileUploadHeader.offsetHeight,n=e.$.fileUploadFooter.offsetHeight,s=e.style.height,o=0;i&&(e._rowHeight=i.offsetHeight),e.style.height="auto",e._containerOverflows&&e.$.container.classList.remove("jqx-overflow"),e._elementsAutoHeight=e.offsetHeight,e.style.height=s,e._containerOverflows&&e.$.container.classList.add("jqx-overflow"),e.$.totalFiles.classList.contains("jqx-hidden")>-1&&(e.$.totalFiles.classList.remove("jqx-hidden"),o=e.$.totalFiles.offsetHeight,e.$.totalFiles.classList.add("jqx-hidden")),e._availableHeight=e.offsetHeight-(a+n)-l-o}}],[{key:"properties",get:function(){return{accept:{value:null,type:"string?"},appendTo:{value:null,type:"any"},autoUpload:{value:!1,type:"boolean"},directory:{value:!1,type:"boolean"},dropZone:{value:null,type:"any"},hideFooter:{value:!1,type:"boolean"},itemTemplate:{value:null,type:"any"},messages:{value:{en:{browse:"Browse",uploadFile:"Upload File",cancelFile:"Cancel File",pauseFile:"Pause File",uploadAll:"Upload All",cancelAll:"Cancel All",pauseAll:"Pause All",totalFiles:"Total files: ",connectionError:"{{elementType}}: File Upload requires connection to the server.",wrongItemIndex:"{{elementType}}: There is no file with such an index in the list of uploaded files.",tooLongFileName:"{{elementType}}: File name is too long."}},type:"object",extend:!0},multiple:{value:!1,type:"boolean"},name:{value:"",type:"string"},responseHandler:{value:null,type:"function?",reflectToAttribute:!1},setHeaders:{value:null,type:"function?",reflectToAttribute:!1},showProgress:{value:!1,type:"boolean"},validateFile:{value:null,type:"function?",reflectToAttribute:!1},uploadUrl:{value:"",type:"string",reflectToAttribute:!1}}}},{key:"listeners",get:function(){return{"browseButton.click":"browse","browseInput.change":"_browseInputChangeHandler","selectedFiles.click":"_selectedFilesClickHandler","uploadAllButton.click":"uploadAll","cancelAllButton.click":"cancelAll","pauseAllButton.click":"pauseAll","dropZone.dragenter":"_dropZoneHandler","dropZone.dragleave":"_dropZoneHandler","dropZone.dragover":"_dropZoneHandler","dropZone.drop":"_dropZoneHandler",resize:"_handleComponentsByAvailableHeight"}}},{key:"requires",get:function(){return{"JQX.Button":"jqxbutton.js","JQX.ProgressBar":"jqxprogressbar.js"}}}]),t}(JQX.BaseElement));
//# sourceMappingURL=jqxfileupload.js.map
