"use strict";var DataAdapter=function(){function e(a){babelHelpers.classCallCheck(this,e),a||(a={});var t=Object.assign(this,a);t.key=function(){return function(){return(65536*(1+Math.random())|0).toString(16).substring(1)}()}(),t.$document=JQX.Utilities.Extend(document),t.boundSource=!1===t.observable?[]:new JQX.ObservableArray,t.dataItemById=[],void 0===t.allowAdd&&(t.allowAdd=!0),void 0===t.allowRemove&&(t.allowRemove=!0),void 0===t.allowUpdate&&(t.allowUpdate=!0),void 0===a.observable&&(t.observable=!0),a.dataSource||(t.dataSource=[]),a.dataFields||(t.dataFields=[]),a.dataSourceType||(t.dataSourceType="array"),a.id||(t.id=null),a.autoFetch||(t.autoFetch=!0),a.dataFields&&(t.dataFields=a.dataFields),a&&!1!==a.autoBind&&t.dataBind(),t.isInitialized=!0}return babelHelpers.createClass(e,[{key:"_getDataFieldObjects",value:function(e){var a=[];if("number"==typeof e)for(var t="A".charCodeAt(0),r="",n=0,i=0;i<e;i++){var o=String.fromCharCode(t+n);n++;var d=r+o;a.push({name:d,dataType:"string"}),n>=26&&(n=0,r+="A")}else if(e.length>0)for(var l=0;l<e.length;l++){var u=e[l];if("string"==typeof u){var c=u.split(":"),s=c[0].trim(),f=c.length>1?c[1].trim():"string";a.push({name:s,dataType:f})}else a.push(u)}return a}},{key:"_notify",value:function(e){var a=this;a.canNotify&&a.notifyFn&&a.notifyFn(e)}},{key:"notify",value:function(e){var a=this;e&&(a.notifyFn=e)}},{key:"toArray",value:function(){return this.boundSource.toArray()}},{key:"dataBind",value:function(){var e=this;e.clear();var a=function(){e.observable&&e.boundSource.notify(function(a){if("update"===a.action&&a.path&&a.path.indexOf(".")>=0&&-1===a.path.indexOf("children")&&-1===a.path.indexOf("loaded")&&-1===a.path.indexOf("level")&&-1===a.path.indexOf("leaf")&&-1===a.path.indexOf("expanded")){for(var t=!1,r=0;r<e.dataFields.length;r++){var n=e.dataFields[r].name;a.path.indexOf(n)>=0&&(t=!0)}e._notify&&t&&e._notify({action:"update",data:a.target,index:a.index})}}),e.groupBy||(e.groupBy=[]),e.groupBy=new JQX.ObservableArray(e.groupBy),e.groupBy.notify(function(){e.boundHierarchy=null,e.refreshHierarchy(),e.onGroup&&e.onGroup()}),e._onBindingComplete()};"string"==typeof e.dataSource&&e.dataSource.indexOf(".json")>=0?(e.url=e.dataSource,e.dataSourceType="json"):"string"==typeof e.dataSource&&e.dataSource.indexOf(".xlsx")>=0?(e.url=e.dataSource,e.dataSourceType="xlsx"):"string"==typeof e.dataSource&&e.dataSource.indexOf(".csv")>=0?e.dataSourceType="csv":"string"==typeof e.dataSource&&e.dataSource.indexOf(".tsv")>=0?e.dataSourceType="tsv":"array"===e.dataSourceType?(e._bindToArray(),a()):"json"===e.dataSourceType&&(e._bindToJSON(),a())}},{key:"_onBindingComplete",value:function(){var e=this;e._buildHierarchy(),e.onBindingComplete&&e.onBindingComplete({data:e.boundSource}),e._notify&&e._notify({action:"bindingComplete",data:e.boundSource}),e.bindingCompleted=!0}},{key:"refreshHierarchy",value:function(){this._buildHierarchy()}},{key:"find",value:function(){var e=this;return e.boundSource.find.apply(e.boundSource,arguments)}},{key:"onVirtualDataSourceRequested",value:function(e,a){var t=this,r=a?a.first:1/0,n=a?a.last:1/0,i=a?a.row:null;if(void 0===r&&(r=1/0),void 0===n&&(n=1/0),t.virtualFirstIndex=r,t.virtualLastIndex=n,t.virtualDataSource){var o=function(o){o.virtualDataSourceLength&&(t.virtualDataSourceLength=o.virtualDataSourceLength),new JQX.DataAdapter({dataSource:o.dataSource,dataFields:o.dataFields||t.dataFields,data:a,onBindingComplete:function(a){if(t.virtualDataSourceOnExpand&&i)return a.data&&a.data.length>0?t.add(a.data,i.$.id):i.leaf=!0,t.onFilter&&t.onFilter(),void e();if(r===1/0)t.add(a.data);else{for(var o=[],d=[],l=0;l<a.data.length;l++){var u=a.data[l];r+l<=n&&(o.push(u),d.push(r+l))}t.update(d,o)}t.onFilter&&t.onFilter(),e()}})},d=!1,l=function(e){return 0===Object.entries(e).length&&(e.constructor===Object||e.constructor===Array)},u=l(a.sorting)&&l(a.filtering)&&l(a.grouping)&&!a.row&&"filter"!==a.action&&"sort"!==a.action&&"group"!==a.action;if(t.virtualDataSourceCache&&r!==1/0&&u){for(var c=0,s=r;s<n;s++)t[s].isEmpty||c++;c===n-r&&(d=!0)}d?e():"expand"===a.action?t.virtualDataSourceOnExpand(o,{first:r,last:n,row:a.row,sorting:a.sorting,filtering:a.filtering,grouping:a.grouping,action:a.action}):t.virtualDataSource(o,{first:r,last:n,sorting:a.sorting,filtering:a.filtering,grouping:a.grouping,action:a.action})}else e()}},{key:"add",value:function(e,a){var t=this;if(e){var r=!0,n=function(e){var n=t._getDataItem(e,t.boundSource.length);t[t.boundSource.length]=n,t.dataItemById[n.$.id]=n;var i=t.boundSource.push(n);return void 0!==a&&(n.$.parentId=a),i||(r=!1),n};if(e.length){for(var i=[],o=0;o<e.length;o++){var d=n(e[o]);i.push(d)}t._notify({action:"add",data:i})}else{var l=n(e);t._notify({action:"add",data:l})}return t.refreshHierarchy(),r}}},{key:"refreshIndexes",value:function(){for(var e=this,a=0;a<e.boundSource.length;a++)e[a]=e.boundSource[a]}},{key:"removeLast",value:function(){var e=this;delete e[e.boundSource.length-1];var a=e.boundSource.pop();return e._notify({action:"removeLast",data:a}),e.refreshHierarchy(),a}},{key:"remove",value:function(e){var a=this,t=a.boundSource[e];if(!t)throw new Error("Invalid Item Index");a.boundSource.splice(e,1),a.refreshIndexes(),a._notify({action:"remove",index:e,data:t}),a.refreshHierarchy()}},{key:"update",value:function(e,a){var t=this;if(!JQX.Utilities.Types.isArray(e)||!JQX.Utilities.Types.isArray(a)||0!==e.length||0!==a.length){if(a.length&&e.length){for(var r=[],n=0;n<e.length;n++){var i=t._getDataItem(a[n],e[n]),o=e[n];r.push(i),t.boundSource[o]=i,t[o]=t.boundSource[o],t.dataItemById[i.$.id]=t[o]}return t._notify({action:"update",index:e,data:r}),void t.refreshHierarchy()}var d=t._getDataItem(a,e);return t.boundSource[e]=d,t[e]=t.boundSource[e],t.dataItemById[d.$.id]=t[e],t._notify({action:"update",index:e,data:d}),t.refreshHierarchy(),d}}},{key:"insert",value:function(e,a){var t=this;a=t._getDataItem(a,e);var r=t.boundSource.splice(e,0,a);return t.refreshIndexes(),t._notify({action:"insert",index:e,data:a}),t.refreshHierarchy(),r}},{key:"move",value:function(e,a){if(!(a>e&&a-e==1||e===a)){var t=this,r=t.boundSource.splice(e,1)[0];a>e?(a--,t.boundSource.splice(a,0,r)):t.boundSource.splice(a,0,r),t.refreshIndexes(),t._notify({action:"move",index:a,data:t.boundSource[a]}),t.refreshHierarchy()}}},{key:"indexOf",value:function(e){return this.boundSource.indexOf(e)}},{key:"clear",value:function(){var e=this;if(!e.isInitialized)return e._cachedValues=[],void(e.dataItemById=[]);for(var a=0;a<e.boundSource.length;a++)delete e[a];e._cachedValues=[],e.boundSource=e.observable?new JQX.ObservableArray:[],e.dataItemById=[],e.refreshHierarchy()}},{key:"_getId",value:function(e,a,t){if(null===e||void 0===e.name||!e.name||!a.getAttribute){if(e&&e.toString().length>0&&a.getAttribute){var r=a.getAttribute(e);if(null!==r&&r.toString().length>0)return r.trim().split(" ").join("").replace(/([ #;?%&,.+*~\':'!^$[\]()=>|\/@])/g,"");var n=e.split(this.mapChar);if(n.length>1){for(var i=a,o=0;o<n.length;o++)void 0!==i&&(i=i[n[o]]);if(void 0!==i)return i}else if(void 0!==a[e])return a[e]}return t}var d=a.getAttribute(e.name);if(null!==d&&d.toString().length>0)return d;if(e.map)try{var l=a.getAttribute(e.map);if(null!==l&&l.toString().length>0)return l}catch(e){return t}}},{key:"_buildHierarchy",value:function(){var e=this;if(e.reservedNames){var a=e.reservedNames;a.leaf||(a.leaf="leaf"),a.parent||(a.parent="parent"),a.expanded||(a.expanded="expanded"),a.checked||(a.checked="checked"),a.selected||(a.selected="selected"),a.level||(a.level="level"),a.data||(a.data="data")}else e.reservedNames={leaf:"leaf",parent:"parent",expanded:"expanded",checked:"checked",selected:"selected",level:"level",icon:"icon",data:"data"};var t=e.reservedNames;if(e.childrenDataField){for(var r=[],n=0;n<e.boundSource.length;n++){(function(a){var n=Object.assign({},e.boundSource[a]);if(!n)return"continue";r.push(n);var i=function(a){var r=e.childrenDataField.split(e.mapChar),n=null;if(r.length>1){for(var i=a,o=0;o<r.length;o++)void 0!==i&&(i=i[r[o]]);n=i}else n=a.children;a.children=n,(null===a.children||void 0===a.children||a.children&&0===a.children.length)&&(a[t.leaf]=!0)};i(n),n[t.level]=0,n.$||(n.$={}),n[t.parent]=null,n[t.data]=n,void 0===n[t.expanded]&&(n[t.expanded]=!1);!function a(r,n){if(!n)return void(r.children=new Array);for(var o=0;o<n.length;o++){var d=e._getDataItem(n[o],o);d&&(i(d),d[t.level]=r[t.level]+1,d[t.parent]=r,d[t.data]=d,r&&(r.children[o]=d),void 0===d[t.expanded]&&(d[t.expanded]=!1),a(d,d.children))}}(n,n.children)})(n)}if(e.boundHierarchy=r,!e._boundSourceUpdate){for(var n=0;n<e.boundHierarchy.length;n++){var i=e.boundHierarchy[n];i.children&&function(){!function a(t){if(e.dataItemById[t.$.id]||(e.boundSource.canNotify=!1,e.dataItemById[t.$.id]=t,e[e.boundSource.length]=t,e.boundSource.push(t),e.boundSource.canNotify=!0),t.children)for(var r=0;r<t.children.length;r++){var n=t.children[r];n.children&&a(n)}}(i)}()}e._boundSourceUpdate=!0}}e.xmlRoot&&"xml"===e.dataSourceType&&(e.boundHierarchy=this._getHierarchy("uid","_parentuid","children",null,e.boundSource)),e.keyDataField&&e.parentDataField&&(e.boundHierarchy=this._getHierarchy(e.keyDataField,e.parentDataField,"children",null,e.boundSource)),e.groupBy&&e.groupBy.length>0&&(e.boundHierarchy=this._getGroupHierarchy(e.groupBy,"children","label",null,"data",null,"parent",e.boundSource)),e.virtualDataSourceOnExpand&&(e.boundHierarchy=this._getHierarchy("id","parentId","children",null,e.boundSource))}},{key:"_getGroupHierarchy",value:function(e,a,t,r,n,i,o,d,l){var u=this;l||(l=0);for(var c=u.reservedNames,s=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},f=new Array,v=0;v<e.length;v++)f[v]=s();a||(a="children"),t||(t="group"),n||(n="item"),o||(o="parent"),void 0===i&&(i="value");for(var h=new Array,p=new Array,y=0,g=0;g<d.length;g++){var b=Object.assign({},function(e){var a=e;if(r)for(var t in r){var n=r[t];n.name&&n.map&&(a[n.map]=a[n.name])}return a}(d[g]));b[c.leaf]=!1;for(var m=new Array,S=0,F=0;F<e.length;F++){var x=e[F],_=b[x];null!==_&&(m[S++]={value:_,group:x,hash:f[F]})}if(m.length!==e.length)break;for(var T=null,A="",k=0;k<m.length;k++){var w=m[k].value,I=m[k].group;if(A=A+"_"+m[k].hash+"_"+w,void 0===p[A]||null===p[A]){if(null===T){T={$:{}},T[c.level]=0,T[c.leaf]=!1,T[o]=null,T[t]=w,T[n]=b,T.groupDataField=I,void 0!==b[c.expanded]?T[c.expanded]=b[c.expanded]:T[c.expanded]=!1,i&&(T[i]=b[i]),T[a]=new Array;var N=h.length+l;this.id&&"number"!=typeof b.$.id&&!isFinite(b.$.id)||(N="Item"+N),void 0===T.$.id&&(T.$.id=N),h[y++]=T}else{var H={$:{}};H[c.level]=T[c.level]+1,H[o]=T,H[t]=w,H[a]=new Array,H[n]=b,H.groupDataField=I,H[c.leaf]=!1,void 0!==b[c.expanded]?H[c.expanded]=b[c.expanded]:H[c.expanded]=!1,i&&(H[i]=b[i]),void 0===H.$.id&&(H.$.id=T.$.id+"_"+T[a].length),T[a][T[a].length]=H,T=H}p[A]=T}else T=p[A]}b&&(b[c.leaf]=!0),null!==T?(null===this.id?void 0===b.$.id&&(b.$.id=T.$.id+"_"+T[a].length):void 0===b.$.id&&-1===b.$.id.toString().indexOf(T.$.id)&&(b.$.id=T.$.id+"_"+b.$.id),b[o]=T,b[c.level]=T[c.level]+1,T[a][T[a].length]=b):void 0===b.$.id&&(b.$.id=s())}return h}},{key:"_getHierarchy",value:function(e,a,t,r,n){var i=this,o=new Array,d=this.boundSource;if(n&&(d=n),0===this.boundSource.length)return null;for(var l=null!==t?t:"children",u=new Array,c=d,s=c.length,f=i.reservedNames,v=function(e){var a=e;if(r)for(var t in r){var n=r[t];n.name&&n.map&&(a[n.map]=a[n.name])}return a},h=0;h<s;h++){var p=c[h],y=p[a],g=p[e];"parentId"===a&&(y=p.$.parentId),"id"===e&&(g=p.$.id),p[l]=new Array,u[g]={parentId:y,item:p}}for(var b=0;b<s;b++){var m=c[b],S=m[a],F=m[e];if("parentId"===a&&(S=m.$.parentId),"id"===e&&(F=m.$.id),void 0!==u[S]){var x={parentId:S,item:u[F].item},_=u[S].item;_[l]||(_[l]=new Array);var T=_[l].length;x=x.item,f?void 0===x[f.parent]&&(x[f.parent]=_):void 0===x.parent&&(x.parent=_);var A=v(x);_[l][T]=A,u[S].item=_,u[F].item=x}else{var k=u[F].item;f?void 0===k[f.parent]&&(k[f.parent]=null):void 0===k.parent&&(k.parent=null);var w=v(k);f?w[f.level]=0:w.level=0,o[o.length]=w}}if(0!==o.length){!function e(a,t){for(var r=0;r<t.length;r++){var n=t[r];f?n[f.level]=a:n.level=a;var o=n[l];o&&o.length>0?e(a+1,o):i.virtualDataSourceOnExpand?void 0===n.leaf&&(n.leaf=!1):f?n[f.leaf]=!0:n.leaf=!0}}(0,o)}return o}},{key:"summarize",value:function(e,a){var t=this;Array.isArray(e)||(e=[e]);for(var r=[],n=0;n<e.length;n++){var i=e[n];for(var o in i){var d=i[o];r.push({dataField:o,functions:d})}}e=r;var l={},u=new Array;a||(a=t.boundSource);var c=a.length;if(0!==c&&void 0!==c){for(var s=0;s<c;s++)!function(t){for(var r=a[t],n=0;n<e.length;n++)!function(a){var n=e[a],i=r[n.dataField];if(n.functions){l[n.dataField]=l[n.dataField]||{},u[n.dataField]=u[n.dataField]||0,u[n.dataField]++;var o=function(e){for(var a in e){var t=l[n.dataField][a];null!==t&&void 0!==t||(l[n.dataField][a]=0,t=0),"function"==typeof e[a]&&(t=e[a](t,i,n.dataField,r)),l[n.dataField][a]=t}},d=parseFloat(i);d=!isNaN(d),d&&(i=parseFloat(i)),"number"==typeof i&&isFinite(i)?n.functions.forEach(function(e){var a=l[n.dataField][e];if(null!==a&&void 0!==a||(a=0,"min"===this&&(a=9999999999999),"max"===this&&(a=-9999999999999)),"sum"===e||"avg"===e||"stdev"===e||"stdevp"===e||"var"===e||"varp"===e)a+=parseFloat(i);else if("product"===e)0===t?a=parseFloat(i):a*=parseFloat(i);else if("min"===e)a=Math.min(a,parseFloat(i));else if("max"===e)a=Math.max(a,parseFloat(i));else if("count"===e)a++;else if("object"===(void 0===e?"undefined":babelHelpers.typeof(e)))return void o(e);l[n.dataField][e]=a}):n.functions.forEach(function(e){if("min"===e||"max"===e||"count"===e||"product"===e||"sum"===e||"avg"===e||"stdev"===e||"stdevp"===e||"var"===e||"varp"===e){if(null===i)return!0;var a=l[n.dataField][e];return null!==a&&void 0!==a||(a=0),l[n.dataField][e]=a,!0}"object"===(void 0===e?"undefined":babelHelpers.typeof(e))&&o(e)})}}(n)}(s);for(var f=0;f<e.length;f++){(function(t){var r=e[t];if(!r.functions)return"continue";if(l[r.dataField]||(l[r.dataField]={},r.functions.forEach(function(e){l[r.dataField][e]=0})),void 0!==l[r.dataField].avg){var n=l[r.dataField].avg,i=u[r.dataField];l[r.dataField].avg=0===i||void 0===i?0:n/i}else void 0!==l[r.dataField].count&&(l[r.dataField].count=c);(l[r.dataField].stdev||l[r.dataField].stdevp||l[r.dataField].var||l[r.dataField].varp)&&r.functions.forEach(function(e){if("stdev"===e||"var"===e||"varp"===e||"stdevp"===e){for(var t=l[r.dataField][e],n=c,i=t/c,o=0,d=0;d<c;d++){var u=a[d],s=u[r.dataField];o+=(s-i)*(s-i)}var f="stdevp"===e||"varp"===e?n:n-1;0===f&&(f=1),"var"===e||"varp"===e?l[r.dataField][e]=o/f:"stdevp"!==e&&"stdev"!==e||(l[r.dataField][e]=Math.sqrt(o/f))}})})(f)}return l}}},{key:"_getDataItem",value:function(e,a){var t=this,r={},n="number"==typeof t.dataSource||t.dataSourceLength;if(!e)return{$:{id:a},isEmpty:!0,index:a};if(n){for(var i=0;i<t.dataFields.length;i++){r[(t.dataFields?t.dataFields[i]:{}).name]=""}return r.$={},r.$.id=a,r.$.index=a,r}var o=e;if(void 0!==o.expanded&&(r.expanded=o.expanded,"true"===o.expanded||!0===o.expanded||1===o.expanded?r.expanded=!0:r.expanded=!1),t.childrenDataField?void 0!==o[t.childrenDataField]&&(r.children=o[t.childrenDataField]):void 0!==o.children?r.children=o.children:void 0!==o.items&&(r.children=o.items),void 0!==o.leaf&&(r.leaf=o.leaf),void 0!==o.level&&(r.level=o.level),t.keyDataField&&void 0!==o[t.keyDataField]&&(r[t.keyDataField]=o[t.keyDataField]),t.parentDataField&&void 0!==o[t.parentDataField]&&(r[t.parentDataField]=o[t.parentDataField]),0===t.dataFields.length)for(var d=Object.getOwnPropertyNames(e),l=0;l<d.length;l++)t.dataFields.push({name:d[l],dataType:"string"});for(var u=0;u<t.dataFields.length;u++){var c=t.dataFields?t.dataFields[u]:{},s="";if(void 0!==c&&null!==c){if(e.length&&(s=e[u]),c.map){var f=c.map.split(t.mapChar);if(f.length>0){for(var v=o,h=0;h<f.length;h++)o&&(v=v[f[h]]);s=v}else s=o[c.map]}void 0!==s&&null!==s?s=s.toString():void 0===s&&null!==s&&(s="");var p=!1;""===s&&(p=!0,s=e[c.name],void 0!==s&&null!==s?"array"!==c.dataType&&"date"!==c.dataType&&(s=s.toString()):s=""),"[object Object]"===s&&c.map&&p&&(s=""),t._cachedValues[s+"_"+c.dataType]?s=t._cachedValues[s+"_"+c.dataType]:("bool"===c.dataType||"boolean"===c.dataType?"true"===s||"1"===s?s=!0:"false"!==s&&"0"!==s||(s=!1):s=t.$document.deserialize(""+s,c.dataType,!0),t._cachedValues[s+"_"+c.dataType]=s),"string"!==c.dataType&&"boolean"!==c.dataType&&"bool"!==c.dataType&&(isNaN(s)||s===-1/0||s===1/0)&&(s=0),r[c.name]=s}}var y=a;return t.id?(y=o[t.id],"object"===(void 0===y?"undefined":babelHelpers.typeof(y))&&(y=a)):t.dataItemById&&t.dataItemById[y]&&(y=t.length),r.$||(r.$={}),r.$.id=y,r.$.index=a,new Object(r)}},{key:"_bindToArray",value:function(){var e=this,a="number"==typeof e.dataSource||e.dataSourceLength,t=[];e.boundSource.canNotify=!1;for(var r=0;r<e.length;r++){var n=a?{}:e.dataSource[r],i=e._getDataItem(n,r);t.push(i)}if(a&&e.dataSourceLength&&e.dataSource.length>0)for(var o=0;o<e.dataSource.length;o++){var d=e.dataSource[o].cell,l=e.dataSource[o].value,u=d.replace(/[^0-9]/g,""),c=d.replace(/[0-9]/g,"");t[u-1][c]=l}e.boundSource=!1===e.observable?t:new JQX.ObservableArray(t);for(var s=0;s<e.length;s++)e[s]=e.boundSource[s],e.dataItemById[e[s].$.id]=e[s];e.boundSource.canNotify=!0}},{key:"_bindToJSON",value:function(){var e=this,a=[],t=Object.entries(e.dataSource);e.boundSource.canNotify=!1;for(var r=0;r<t.length;r++){var n=t[r],i=e._getDataItem(n,r);a.push(i)}e.boundSource=!1===e.observable?a:new JQX.ObservableArray(a);for(var o=0;o<e.length;o++)e[o]=e.boundSource[o],e.dataItemById[e[o].$.id]=e[o];e.boundSource.canNotify=!0}},{key:"sortBy",value:function(e,a,t){var r=this;if(!a)for(var n=0;n<r.dataFields.length;n++){var i=r.dataFields[n];if(i.name===e){a=i.dataType;break}}if(r.boundHierarchy){!function n(i){r._sort(i,e,t,a);for(var o=0;o<i.length;o++){var d=i[o];d.children&&n(d.children,e,t,a)}}(r.boundHierarchy)}else r._sort(r.boundSource,e,t,a)}},{key:"_createFilter",value:function(e,a){for(var t={"=":"EQUAL","<>":"NOT_EQUAL","<":"LESS_THAN",">":"GREATER_THAN","<=":"LESS_THAN_OR_EQUAL",">=":"GREATER_THAN_OR_EQUAL",equal:"EQUAL","not equal":"NOT_EQUAL","less than":"LESS_THAN","greater than":"GREATER_THAN","greater than or equal":"GREATER_THAN_OR_EQUAL","less than or equal":"LESS_THAN_OR_EQUAL","starts with":"STARTS_WITH","ends with":"ENDS_WITH",null:"null","":"EMPTY",isblank:"EMPTY",isnotblank:"NOT_EMPTY",contains:"CONTAINS",notcontains:"DOES_NOT_CONTAIN",startswith:"STARTS_WITH",endswith:"ENDS_WITH",NULL:"NULL",NOT_NULL:"NOT_NULL"},r=[],n=0;n<a.length;n++){for(var i=a[n],o=-1===i.indexOf('"')?i.split(" "):i.split('"'),d=[],l=0;l<o.length;l++){var u=o[l];""!==u&&d.push(u.trim())}r.push(d)}for(var c=new JQX.FilterGroup,s=[],f=[],v=0;v<r.length;v++){var h=r[v];if(h.length>1){for(var p=new JQX.FilterGroup,y="and",g=0,b=0;b<h.length;b++){var m=h[b];if("and"!==m&&"or"!==m){if(2===++g){var S=p.createFilter(e,m,t[h[b-1]]);g=0,y&&p.addFilter(y,S)}}else y=m}f.push(p)}else{var F=h[0];if("and"!==F&&"or"!==F)throw new Error('Filter Exprresion expects "AND" or "OR", but the token is: '+F);s.push(F)}}var x=0;if(1===f.length)return f[0];for(var _=0;_<f.length;_++){var T=s[x];(_+1)%2==0&&x++,T||(T="and"),c.addFilter(T,f[_])}return c}},{key:"filterBy",value:function(e){for(var a=this,t=function(){for(var t=0;t<a.dataFields.length;t++){var r=a.dataFields[t];if(r.name===e)return r.dataType}}(),r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];var o=a._createFilter(t,n);return a.boundSource.filter(function(a){return o.evaluate(a[e])})}},{key:"_filter",value:function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"and",t=this,r=[],n=[];if(0===e.length)return void t.clearFilter();var i=void 0,o=void 0;"and"===a?(i=!0,o=function(e,a,t){return e&&a.evaluate(t[a.dataField])}):(i=!1,o=function(e,a,t){return e||a.evaluate(t[a.dataField])});for(var d=0;d<e.length;d++){var l=e[d],u=l[0],c=null;c=l[1]instanceof JQX.FilterGroup?l[1]:t._createFilter(function(e){for(var a=0;a<t.dataFields.length;a++){var r=t.dataFields[a];if(r.name===e)return r.dataType}}(u),l.splice(1)),c&&(n.push(u),c.dataField=u,r.push(c))}if(t.boundHierarchy){var s=function(e){for(var a=i,t=0;t<r.length;t++){var n=r[t];a=o(a,n,e)}return e.$.filtered=a,a};!function e(a,r,n){for(var i=0,o=0;o<a.length;o++){var d=a[o];s(d),d.$.filtered&&i++,d.children&&e(d.children,d,r)}i>0&&t.groupBy.length>0&&r?(r.$.filtered=!0,n&&!n.$.filtered&&(n.$.filtered=!0)):i>0&&i!==a.length&&r&&(r.$.filtered=null,n&&!n.$.filtered&&(n.$.filtered=null))}(t.boundHierarchy,null,null)}else for(var f=0;f<t.boundSource.length;f++){for(var v=t.boundSource[f],h=i,p=0;p<r.length;p++){var y=r[p];h=o(h,y,v)}v.$.filtered=h}t.onFilter&&t.onFilter()}},{key:"clearGroup",value:function(){var e=this;e.groupBy=[],e.boundHierarchy=null,e.refreshHierarchy(),e.onGroup&&e.onGroup()}},{key:"clearFilter",value:function(){for(var e=this,a=0;a<e.boundSource.length;a++){e.boundSource[a].$.filtered=!0}if(e.boundHierarchy){!function e(a,t,r){for(var n=0;n<a.length;n++){var i=a[n];i.$.filtered=!0,i.children&&e(i.children,i,t)}t&&(t.$.filtered=!0,r&&!r.$.filtered&&(r.$.filtered=!0))}(e.boundHierarchy,null,null)}e.onFilter&&e.onFilter()}},{key:"clearSort",value:function(){var e=this;e._sort(e.boundSource,[],[],[])}},{key:"_sort",value:function(e,a,t,r,n){var i=this,o=!1;if(0!==e.length){if(e&&e.constructor&&e instanceof JQX.ObservableArray&&(o=!0),(!e||!Array.isArray(e)||0===e.length||!a||Array.isArray(a)&&0===a.length)&&!o&&!i.boundHierarchy)throw new Error("sort: Missing or Invalid arguments!");"string"==typeof a&&(a=[a]);var d=[],l=[];void 0===t&&(t=[]);for(var u=0;u<a.length;u++){void 0===t[u]||"asc"===t[u]||"ascending"===t[u]?d[u]=1:d[u]=-1;var c=e[0][a[u]];l[u]=function(e,a){var t=a||(void 0===e?"undefined":babelHelpers.typeof(e)),r=void 0;switch(t){case"string":r=(new Intl.Collator).compare;break;case"number":r=function(e,a){return e-a};break;case"boolean":case"bool":r=function(e,a){return e===a?0:!1===e?-1:1};break;case"date":case"time":case"dateTime":e instanceof Date?r=function(e,a){return e.getTime()-a.getTime()}:(e instanceof JQX.Utilities.DateTime||e instanceof JQX.Utilities.BigNumber)&&(r=function(e,a){return e.compare(a)});break;case"object":if(e instanceof Date)r=function(e,a){return e.getTime()-a.getTime()};else if(e instanceof JQX.Utilities.DateTime||e instanceof JQX.Utilities.BigNumber)r=function(e,a){return e.compare(a)};else if(e instanceof JQX.Utilities.Complex||window.NIComplex&&e instanceof window.NIComplex){var n=new JQX.Utilities.ComplexNumericProcessor;r=function(e,a){return n.compareComplexNumbers(e,a)}}}return r}(c,r[u])}if(n)return void n(e,a,t,l);e.sort(function(e,t){for(var r=0;r<a.length;r++){var n=l[r](e[a[r]],t[a[r]]);if(0===n){if(a[r+1])continue;return void 0!==e._index?(e._index-t._index)*d[r]:0}return n*d[r]}if(0===a.length)return e.$.index<t.$.index?-1:e.$.index>t.$.index?1:0});for(var s=0;s<e.length;s++)i[s]=e[s]}}},{key:"filter",value:function(e,a,t){JQX.DataAdapter.Filter(this.boundSource,e,a,t)}},{key:"sort",value:function(e,a,t){JQX.DataAdapter.Sort(this.boundSource,e,a,t)}},{key:"dataFields",get:function(){return this._dataFields},set:function(e){var a=this;return a._dataFields=a._getDataFieldObjects(e),a._dataFields}},{key:"dataSource",get:function(){var e=this;return e._dataSource||(e._dataSource=[]),e._dataSource},set:function(e){var a=this;a._dataSource=e,a.isInitialized&&(a.boundSource=!1===a.observable?[]:new JQX.ObservableArray,a.dataItemById=[],a.bindingCompleted=!1,a.dataBind())}},{key:"canNotify",get:function(){var e=this;return void 0===e._canNotify&&(e._canNotify=!0),e._canNotify},set:function(e){this._canNotify=e}},{key:"length",get:function(){var e=this;return e.virtualDataSourceLength?e.virtualDataSourceLength:e.dataSourceLength?e.dataSourceLength:"number"==typeof e.dataSource?e.dataSource:e.bindingCompleted?e.boundSource.length:e.dataSource&&"string"!=typeof e.dataSource&&e.dataSource.length?e.dataSource.length:e.boundSource.length}}],[{key:"Filter",value:function(e,a,t,r){return e.filter(function(e){for(var n=!0,i=0;i<t.length;i++){var o=t[i],d=a[i];n=r?n&&r(e,d,o):n&&o.evaluate(e[d])}return n})}},{key:"Sort",value:function(e,a,t,r){if(e&&Array.isArray(e)&&0!==e.length&&a&&(!Array.isArray(a)||0!==a.length)){"string"==typeof a&&(a=[a]);var n=[],i=[];void 0===t&&(t=[]);for(var o=0;o<a.length;o++)void 0===t[o]||"asc"===t[o]||"ascending"===t[o]?n[o]=1:n[o]=-1,i[o]=function(e){var a=void 0===e?"undefined":babelHelpers.typeof(e),t=void 0;switch(a){case"string":t=(new Intl.Collator).compare;break;case"number":t=function(e,a){return e-a};break;case"boolean":t=function(e,a){return e===a?0:!1===e?-1:1};break;case"object":if(e instanceof Date)t=function(e,a){return e.getTime()-a.getTime()};else if(e instanceof JQX.Utilities.DateTime||e instanceof BigNumberNG)t=function(e,a){return e.compare(a)};else if(e instanceof JQX.Utilities.Complex||window.NIComplex&&e instanceof window.NIComplex){var r=new JQX.Utilities.ComplexNumericProcessor;t=function(e,a){return r.compareComplexNumbers(e,a)}}}return t}(e[0][a[o]]);if(r)return void r(e,a,t,i);var d=e.slice(0);return d.sort(function(e,t){for(var r=0;r<a.length;r++){var o=i[r](e[a[r]],t[a[r]]);if(0===o){if(a[r+1])continue;return void 0!==e._index?(e._index-t._index)*n[r]:0}return o*n[r]}}),d}}}]),e}();JQX.DataAdapter=DataAdapter;var Ajax=function(){function e(a,t){babelHelpers.classCallCheck(this,e);var r=this;r.config=a,r.callback=t,!1!==a.autoFetch&&r.call(a)}return babelHelpers.createClass(e,[{key:"call",value:function(e){var a=this;e||(e=a.config);var t="GET",r=e.url,n=null,i=!0;if(e.type&&(t=e.type),e.data)if("GET"===t){r+="?";for(var o in e.data)e.data.hasOwnProperty(o)&&(r+=encodeURI(o+"="+e.data[o]+"&"));"&"===r.charAt(r.length-1)&&(r=r.slice(0,r.length-1))}else"POST"===t&&(n=JSON.stringify(e.data));e&&!1===e.async&&"xlsx"!==e.dataSourceType&&(i=!1),void 0!==window.fetch&&i?a.ajaxFetch(e,t,r,n):a.ajaxXMLHttpRequest(e,t,r,n,i)}},{key:"ajaxFetch",value:function(e,a,t,r){var n=this,i={method:a},o=void 0;switch(e.dataSourceType){case"json":o="json";break;case"xlsx":o="arrayBuffer";break;default:o="text"}e&&e.contentType&&(i.headers=new Headers({"Content-Type":e.contentType})),null!==r&&(i.body=r);var d=void 0,l=void 0,u=void 0;if(e.timeout&&(l=setTimeout(function(){u=!0},e.timeout)),e.beforeSend){if(!1===e.beforeSend(i,e))return}fetch(t,i).then(function(e){if(u)throw d=408,new Error("timeout");if(l&&clearTimeout(l),d=e.status,!e.ok)throw new Error(e.statusText);return e[o]()}).then(function(a){if("arrayBuffer"===o)return JSZip.loadAsync(a).then(function(a){return a.files["xl/worksheets/sheet1.xml"].async("text").then(function(t){return a.files["xl/sharedStrings.xml"].async("text").then(function(a){var r=n.parseXLSXData(t,a);n.ajaxComplete(e,r,d)})})});n.ajaxComplete(e,a,d)}).catch(function(a){"JSZip is not defined"===a.message&&(a.message="JSZip is not defined. Please include a reference to JSZip to be able to load data from XLSX files."),e&&e.loadError&&e.loadError(d,a),n.callback&&n.callback(a,d)})}},{key:"ajaxXMLHttpRequest",value:function(e,a,t,r,n){var i=new XMLHttpRequest,o=this;if(i.open(a,t,n),i.ontimeout=function(){e&&e.loadError&&e.loadError(408,"timeout")},i.onload=function(){if(4===i.readyState){var a=i.status,t=i.response;a>=200&&a<=299?("json"===e.dataSourceType&&(t=JSON.parse(t)),o.ajaxComplete(e,t,a)):e&&e.loadError&&e.loadError(a,t)}},i.onerror=function(){e&&e.loadError&&e.loadError(i.status,i.response)},e&&e.contentType&&i.setRequestHeader("Content-Type",e.contentType),n&&e.timeout&&(i.timeout=e.timeout),e.beforeSend){if(!1===e.beforeSend(i,e))return}i.send(r)}},{key:"ajaxComplete",value:function(e,a,t){if(e){if(e.beforeLoadComplete){var r=e.beforeLoadComplete(a);r&&(a=r)}e.loadComplete&&e.loadComplete(a,t),this.callback&&this.callback(a,t)}}},{key:"parseXLSXData",value:function(e,a){var t=new DOMParser,r=t.parseFromString(a,"text/xml"),n=Array.from(r.getElementsByTagName("si")),i=[],o=t.parseFromString(e,"text/xml"),d=Array.from(o.getElementsByTagName("row")),l=[];return n.forEach(function(e){var a=e.getElementsByTagName("t");if(1===a.length)i.push(a[0].innerHTML);else{var t="";a=Array.from(a),a.forEach(function(e){t+=e.innerHTML}),i.push(t)}}),d.forEach(function(e){var a={};Array.from(e.getElementsByTagName("c")).forEach(function(e){var t=e.getAttribute("r").match(/\D+/)[0],r=e.getAttribute("t"),n=e.getElementsByTagName("v")[0].innerHTML,o=void 0;switch(r){case"s":o=i[parseFloat(n)];break;case"b":o=1===parseFloat(n);break;default:o=parseFloat(n)}a[t]=o}),l.push(a)}),l}}]),e}();
//# sourceMappingURL=jqxdata.js.map
