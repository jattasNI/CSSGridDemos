"use strict";JQX.Utilities.Assign("Grid.Menu",function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,[{key:"openMenu",value:function(e){var n=this,t=n.columnByDataField[e];t&&n._openMenu(t)}},{key:"_openColumnChooserMenu",value:function(e){var n=this;if(e||(e=n._commandColumn),!e||n.menu&&n.menu.column===e&&e.element.hasAttribute("aria-controls"))return void n.closeMenu();n.menu||(n.menu=document.createElement("div"),n.menu.classList.add("jqx-grid-column-menu"),n.menu.id=n.id+"_"+n.tagName.toLowerCase()+"_menu_"+Math.floor(65536*(1+Math.random())).toString(16).substring(1)),n.appearance.allowColumnMenuAnimation?n.menu.classList.add("jqx-animate"):n.menu.classList.remove("jqx-animate"),n._createColumnChooserMenuItems(e),n.menu.style.height=n.columnMenu.height?n.columnMenu.height+"px":"auto",n.menu.column&&n.menu.column!==e&&(n.menu.column.setProperty("menu",null),n.menu.column=null),document.body.appendChild(n.menu),e.setProperty("menu",n.menu);var t=e.element.getBoundingClientRect();n.menu.column=e;var i=t.right-e.element.actionButton.getBoundingClientRect().width+window.pageXOffset,l=t.bottom+window.pageYOffset;i+n.menu.offsetWidth>window.innerWidth&&(i=t.right+window.pageXOffset-n.menu.offsetWidth)+n.menu.offsetWidth>window.innerWidth&&(i=window.innerWidth-n.menu.offsetWidth),n.menu.style.left=i+"px",n.menu.style.top=l+"px",n.menu.classList.remove("jqx-hidden"),n.menu.classList.add("open")}},{key:"_openMenu",value:function(e){var n=this;if(!e||n.menu&&n.menu.column===e&&e.element.hasAttribute("aria-controls"))return void n.closeMenu();n.menu||(n.menu=document.createElement("div"),n.menu.classList.add("jqx-grid-column-menu"),n.menu.id=n.id+"_"+n.tagName.toLowerCase()+"_menu_"+Math.floor(65536*(1+Math.random())).toString(16).substring(1)),n.appearance.allowColumnMenuAnimation?n.menu.classList.add("jqx-animate"):n.menu.classList.remove("jqx-animate"),n._createMenuItems(e),n._createFilterPanel(e),n._filterMenuItemsVisibility(e),n.menu.style.height=n.columnMenu.height?n.columnMenu.height+"px":"auto",n.menu.column&&n.menu.column!==e&&(n.menu.column.setProperty("menu",null),n.menu.column=null),document.body.appendChild(n.menu),e.setProperty("menu",n.menu);var t=e.element.getBoundingClientRect();n.menu.column=e;var i=t.right-e.element.actionButton.getBoundingClientRect().width+window.pageXOffset,l=t.bottom+window.pageYOffset;i+n.menu.offsetWidth>window.innerWidth&&(i=t.right+window.pageXOffset-n.menu.offsetWidth)+n.menu.offsetWidth>window.innerWidth&&(i=window.innerWidth-n.menu.offsetWidth),n.menu.style.left=i+"px",n.menu.style.top=l+"px",n.hasColumnMenu(e)?n.menu.classList.remove("jqx-hidden"):n.closeMenu(),n.menu.classList.add("open")}},{key:"_menuItemClick",value:function(e){var n=this,t=e.detail,i=t.value;if(i&&i.properties){var l=i.properties.command;"function"==typeof l?l.apply(n,[i.column]):n[l]&&n[l].apply(n,[i.column]),i.column.autoCloseMenu&&n.closeMenu()}}},{key:"removeGroupByCommand",value:function(e){this.removeGroup(e.dataField)}},{key:"groupByCommand",value:function(e){var n=this;n.dataSource&&n.addGroup(e.dataField)}},{key:"sortAscCommand",value:function(e){this.sortBy(e.dataField,"asc")}},{key:"sortDescCommand",value:function(e){this.sortBy(e.dataField,"desc")}},{key:"removeSortCommand",value:function(e){this.sortBy(e.dataField,null)}},{key:"_removeMenu",value:function(){var e=this,n=e.menu.querySelector("jqx-menu");n&&e.menu.removeChild(n)}},{key:"_createColumnChooserMenuItems",value:function(){var e=this;e._removeMenu();var n=document.createElement("jqx-menu"),t=document.createDocumentFragment();n.mode="vertical",n.dropDownAppendTo="body",n.checkboxes=!0,n.checkable=!0,n.classList.add("jqx-grid-column-chooser-menu");for(var i=0;i<e.columns.length;i++){var l=e.columns[i],a=document.createElement("jqx-menu-item"),o=l.showIcon?l.icon:l.visible?"jqx-icon-eye":"jqx-icon-eye-off";a.checked=l.visible,l.allowHide&&(l.command=function(e){e.visible=!e.visible},a.label=e.localize(l.label)||l.label||l.dataField,a.value={column:l,properties:l},o&&(a.label='<span class="jqx-grid-icon '+o+'"></span>'+a.label),t.appendChild(a))}n.appendChild(t),e.menu.appendChild(n),e.menu.itemCheckChange=e._menuItemClick.bind(e),e.menu.addEventListener("itemCheckChange",e.menu.itemCheckChange),e.menu.addEventListener("keydown",e._keyDownHandler.bind(e))}},{key:"_createMenuItems",value:function(e){var n=this;n._removeMenu();var t=document.createElement("jqx-menu"),i=document.createDocumentFragment(),l=e.menuItems||n.columnMenu.dataSource;t.mode="vertical",t.dropDownAppendTo="body";for(var a in l){var o=l[a],r=document.createElement("jqx-menu-item"),u=o.icon;r.label=n.localize(a),r.value={column:e,properties:o};var m=function(n){if(n){if("string"===e.dataType)return"A → Z";if("number"===e.dataType||"date"===e.dataType||"time"===e.dataType)return"1 → 9";if("bool"===e.dataType||"boolean"===e.dataType)return"0 → 1"}else{if("string"===e.dataType)return"Z → A";if("number"===e.dataType||"date"===e.dataType||"time"===e.dataType)return"9 → 1";if("bool"===e.dataType||"boolean"===e.dataType)return"1 → 0"}};"columnMenuItemSortAsc"===a?(r.label=n.localize(a,{mode:m(!0)}),"string"!==e.dataType&&o.iconAlt&&(u=o.iconAlt)):"columnMenuItemSortDesc"===a&&(r.label=n.localize(a,{mode:m(!1)}),"string"!==e.dataType&&o.iconAlt&&(u=o.iconAlt)),u&&(r.label='<span class="jqx-grid-icon '+u+'"></span>'+r.label),i.appendChild(r)}t.appendChild(i),n._filterContainer?n.menu.insertBefore(t,n._filterContainer):n.menu.appendChild(t),n.menu.itemClick=n._menuItemClick.bind(n),n.menu.addEventListener("itemClick",n.menu.itemClick),n.menu.addEventListener("keydown",n._keyDownHandler.bind(n))}},{key:"_getFilterType",value:function(e){var n=e.dataType.endsWith("?")?e.dataType.substring(0,e.dataType.length-1):e.dataType,t="string";switch(n){case"number":case"int":case"float":case"int64":t="numeric";break;case"bool":case"boolean":t="bool";break;case"date":case"time":case"datetime":t="date";break;case"any":t="any"}return t}},{key:"_createFilterPanel",value:function(e){var n=this;if(JQX.FilterPanel)if(n.filtering.enabled&&n.filtering.filterMenu.visible&&e.allowFilter){var t=n._getFilterType(e);if(n._filterPanel&&n._filterPanel.parentNode.removeChild(n._filterPanel),n._filterPanel=n._filterPanels[t],n._filterPanel.dataField=e.dataField,!n._filterContainer){var i=document.createElement("div");i.classList.add("jqx-filter-container"),n._filterContainer=i,requestAnimationFrame(function(){n.menu.appendChild(i)}),n._applyFilterHandler=function(){n.addFilter(n._filterPanel.dataField,n._filterPanel.getFilter()),n.columnByDataField[n._filterPanel.dataField]._filterState=n._filterPanel.getState()},n._clearFilterHandler=function(){requestAnimationFrame(function(){n.removeFilter(n._filterPanel.dataField),n.columnByDataField[n._filterPanel.dataField]._filterState=null})}}if(n._filterContainer.appendChild(n._filterPanel),n._filterPanel.classList.remove("jqx-hidden"),n._filterPanel.removeEventListener("filter",n._applyFilterHandler),n._filterPanel.removeEventListener("clear",n._clearFilterHandler),n._filterPanel.addEventListener("filter",n._applyFilterHandler),n._filterPanel.addEventListener("clear",n._clearFilterHandler),"none"!==e.filterMenuMode&&n.filtering.filterMenu.visible&&JQX.FilterPanel?n._filterContainer.classList.remove("jqx-hidden"):n._filterContainer.classList.add("jqx-hidden"),n._filterPanel.reset(),e._filterState)n._filterPanel.loadState(e._filterState);else if(e.filter){for(var l=e.filter,a=n._getFilterType(e),o=l.getFilters();o.length>0&&"FilterGroup"===o[0].type;)o=o[0].value;var r=l.getConditions(a),u=o.length>0?r.indexOf(o[0].condition):-1,m=o.length>1?r.indexOf(o[1].condition):-1,d=o.length>0?o[0].value:"",s=o.length>1?o[1].value:"",c=o.length>1?["and","or"].indexOf(o[1].logicalOperator):0;e._filterState={firstFilterComparison:u,firstFilterValue:d,logicalOperator:c,secondFilterComparison:m,secondFilterValue:s},n._filterPanel.loadState(e._filterState)}}else n._filterPanel&&(n._filterPanel.parentNode.removeChild(n._filterPanel),e._filterState=null)}},{key:"hasColumnMenu",value:function(e){var n=this,t=e.menuItems||n.columnMenu.dataSource,i=0,l=0;for(var a in t){var o=t[a];l++,!1===o.visible?i++:"auto"===o.visible&&("columnMenuItemFilter"!==a&&"columnMenuItemRemoveFilter"!==a||(n.filtering.filterMenu.visible||n.filtering.filterBuilder.visible)&&i++,"columnMenuItemGroupBy"!==a&&"columnMenuItemRemoveGroupBy"!==a||e.allowGroup&&n.grouping.enabled||i++,"columnMenuItemFilter"!==a||e.allowFilter||i++,"columnMenuItemRemoveFilter"!==a||e.allowFilter||i++,"columnMenuItemGroupBy"!==a||e.allowGroup||i++,"columnMenuItemSortAsc"!==a&&"columnMenuItemSortDesc"!==a&&"columnMenuItemRemoveSort"!==a||e.allowSort&&n.sorting.enabled||i++)}return!!(n.filtering.enabled&&n.filtering.filterMenu.visible&&"none"!==e.filterMenuMode&&JQX.FilterPanel||JQX.Menu&&!(i>=l))}},{key:"_filterMenuItemsVisibility",value:function(e){var n=this,t=n.menu.querySelectorAll("jqx-menu-item"),i=e.menuItems||n.columnMenu.dataSource,l=0;for(var a in i){var o=t[l++],r=i[a];if(o.disabled=!r.enabled,o.classList.remove("jqx-hidden"),"columnMenuItemRemoveSort"===a&&(e.sortOrder?o.disabled=!1:o.disabled=!0),"columnMenuItemSortAsc"===a&&"asc"===e.sortOrder?o.disabled=!0:"columnMenuItemSortDesc"===a&&"desc"===e.sortOrder&&(o.disabled=!0),!0===r.visible)o.classList.remove("jqx-hidden");else if(!1===r.visible)o.classList.add("jqx-hidden");else if("auto"===r.visible){if("columnMenuItemFilter"!==a&&"columnMenuItemRemoveFilter"!==a||(!1===n.filtering.enabled?o.classList.add("jqx-hidden"):n.filtering.filterMenu.visible||n.filtering.filterBuilder.visible?o.classList.add("jqx-hidden"):n.filtering.filterBuilder.visible&&o.classList.remove("jqx-hidden")),"columnMenuItemGroupBy"===a){n.grouping.enabled&&e.allowGroup?o.classList.remove("jqx-hidden"):o.classList.add("jqx-hidden");var u=n.dataSource.groupBy.indexOf(e.dataField);o.disabled=u>=0}if("columnMenuItemRemoveGroupBy"===a){n.grouping.enabled&&e.allowGroup?o.classList.remove("jqx-hidden"):o.classList.add("jqx-hidden");var m=n.dataSource.groupBy.indexOf(e.dataField);o.disabled=m<0}"columnMenuItemFilter"!==a||e.allowFilter||o.classList.add("jqx-hidden"),"columnMenuItemRemoveFilter"!==a||e.allowFilter||o.classList.add("jqx-hidden"),"columnMenuItemSortAsc"!==a&&"columnMenuItemSortDesc"!==a&&"columnMenuItemRemoveSort"!==a||(e.allowSort&&n.sorting.enabled?o.classList.remove("jqx-hidden"):o.classList.add("jqx-hidden"))}}}},{key:"hasMenu",value:function(){var e=this;return!!(e.menu&&e.menu.column&&e.menu.parentNode)}},{key:"closeMenu",value:function(){var e=this;e.menu&&e.menu.column&&(e.menu.column&&(e.menu.column.setProperty("menu",null),e.menu.column=null),e.menu.parentNode&&(e.menu.classList.remove("open"),e.appearance.allowColumnMenuAnimation||e.menu.parentNode.removeChild(e.menu)),e.menu.removeEventListener("keydown",e._keyDownHandler.bind(e)),e.menu.removeEventListener("itemClick",e.menu.itemClick),e.menu.removeEventListener("itemCheckChange",e.menu.itemCheckChange),e.focus())}}]),e}());
//# sourceMappingURL=jqxgrid.menu.js.map
